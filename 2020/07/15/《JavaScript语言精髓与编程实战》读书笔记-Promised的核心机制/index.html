<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ã€ŠJavaScriptè¯­è¨€ç²¾é«“ä¸ç¼–ç¨‹å®æˆ˜ã€‹è¯»ä¹¦ç¬”è®°-Promisedçš„æ ¸å¿ƒæœºåˆ¶"><meta name="keywords" content><meta name="author" content="èˆ’å°ç¦"><meta name="copyright" content="èˆ’å°ç¦"><title>ã€ŠJavaScriptè¯­è¨€ç²¾é«“ä¸ç¼–ç¨‹å®æˆ˜ã€‹è¯»ä¹¦ç¬”è®°-Promisedçš„æ ¸å¿ƒæœºåˆ¶ | èˆ’å°ç¦çš„Blog</title><link rel="shortcut icon" href="/shuliqi.github.io/melody-favicon.ico"><link rel="stylesheet" href="/shuliqi.github.io/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/shuliqi.github.io/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹:${query}"}},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="åˆ‡æ¢æ–‡ç« è¯¦æƒ…">åˆ‡æ¢ç«™ç‚¹æ¦‚è§ˆ</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ä»€ä¹ˆæ˜¯Promise"><span class="toc-number">1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯Promise?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#promiseçš„çŠ¶æ€"><span class="toc-number">2.</span> <span class="toc-text">promiseçš„çŠ¶æ€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Promiseçš„ç‰¹ç‚¹"><span class="toc-number">3.</span> <span class="toc-text">Promiseçš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#åˆ›å»ºPromise"><span class="toc-number">4.</span> <span class="toc-text">åˆ›å»ºPromise</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Promiseçš„æ„é€ æ–¹æ³•"><span class="toc-number">5.</span> <span class="toc-text">Promiseçš„æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ„å»ºPromiseå¯¹è±¡ï¼šæ²¡æœ‰å»¶è¿Ÿ"><span class="toc-number">6.</span> <span class="toc-text">æ„å»ºPromiseå¯¹è±¡ï¼šæ²¡æœ‰å»¶è¿Ÿ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Then-é“¾"><span class="toc-number">7.</span> <span class="toc-text">Then é“¾</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#promise1çš„ç½®å€¼é€»è¾‘"><span class="toc-number">7.1.</span> <span class="toc-text">promise1çš„ç½®å€¼é€»è¾‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#promise2çš„ç½®å€¼é€»è¾‘"><span class="toc-number">7.2.</span> <span class="toc-text">promise2çš„ç½®å€¼é€»è¾‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#then-é“¾ä¸­â€œäº§ç”Ÿâ€-rejectå€¼çš„æ–¹æ³•"><span class="toc-number">7.3.</span> <span class="toc-text">then é“¾ä¸­â€œäº§ç”Ÿâ€ rejectå€¼çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Then-é“¾å¯¹å€¼çš„ä¼ é€’"><span class="toc-number">7.4.</span> <span class="toc-text">Then é“¾å¯¹å€¼çš„ä¼ é€’</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Then-é“¾-catch-çš„å¤„ç†"><span class="toc-number">7.5.</span> <span class="toc-text">Then é“¾ catch() çš„å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Promiseçš„ç±»æ–¹æ³•"><span class="toc-number">8.</span> <span class="toc-text">Promiseçš„ç±»æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise-resolve"><span class="toc-number">8.1.</span> <span class="toc-text">Promise.resolve()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise-reject"><span class="toc-number">8.2.</span> <span class="toc-text">Promise.reject()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise-all"><span class="toc-number">8.3.</span> <span class="toc-text">Promise.all()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise-race"><span class="toc-number">8.4.</span> <span class="toc-text">Promise.race()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Promiseå¯¹è±¡çš„åŸå‹æ–¹æ³•"><span class="toc-number">9.</span> <span class="toc-text">Promiseå¯¹è±¡çš„åŸå‹æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise-Prototype-catch"><span class="toc-number">9.1.</span> <span class="toc-text">Promise.Prototype.catch()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise-Prototype-finally"><span class="toc-number">9.2.</span> <span class="toc-text">Promise.Prototype.finally()</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/shuliqi.github.io/img/avatar.png"></div><div class="author-info__name text-center">èˆ’å°ç¦</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/shuliqi.github.io/archives"><span class="pull-left">æ–‡ç« </span><span class="pull-right">36</span></a><a class="author-info-articles__tags article-meta" href="/shuliqi.github.io/tags"><span class="pull-left">æ ‡ç­¾</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/shuliqi.github.io/categories"><span class="pull-left">åˆ†ç±»</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/shuliqi.github.io/">èˆ’å°ç¦çš„Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> æœç´¢</span></a><a class="site-page" href="/">é¦–é¡µ</a><a class="site-page" href="/archives">å½’æ¡£</a><a class="site-page" href="/tags">æ ‡ç­¾</a><a class="site-page" href="/categories">åˆ†ç±»</a><a class="site-page" href="/about">å…³äºæˆ‘</a></span></div><div id="post-info"><div id="post-title">ã€ŠJavaScriptè¯­è¨€ç²¾é«“ä¸ç¼–ç¨‹å®æˆ˜ã€‹è¯»ä¹¦ç¬”è®°-Promisedçš„æ ¸å¿ƒæœºåˆ¶</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-07-15</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/shuliqi.github.io/categories/å­¦ä¹ ç¬”è®°/">å­¦ä¹ ç¬”è®°</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>æœ€è¿‘å‚éƒ¨é—¨çš„è¯»ä¹¦ä¼šï¼Œè¯»ä¹¦ä¼šä¼šæ¨èä¸€äº›ä¹¦æ¥ä¾›æˆ‘ä»¬å­¦ä¹ ï¼Œ è¿™æ¬¡çš„è¯»ä¹¦ä¼šæ¨èè¯»çš„ä¹¦æ˜¯ã€ŠJavaScriptè¯­è¨€ç²¾é«“ä¸ç¼–ç¨‹å®æˆ˜ã€‹ã€‚æ„Ÿè§‰å†™çš„å¾ˆä¸é”™ï¼Œæˆ‘è¿™æ¬¡å­¦ä¹ çš„æ˜¯ã€Promiseçš„æ ¸å¿ƒæœºåˆ¶ã€‘, è™½ç„¶ä¹‹å‰ä¹Ÿçœ‹è¿‡å…³äº<code>Promise</code>  <a href="https://shuliqi.github.io/2018/03/20/ES6å­¦ä¹ -Promise/">ES6å­¦ä¹ ç¬”è®°-Promise</a>, ä½†æ˜¯åœ¨çœ‹è¿™æœ¬ä¹¦ä¹‹åï¼Œè®²çš„æ›´å¤šå…³äº<code>Promise</code>çš„åŸç†ã€‚è¿˜æ˜¯æœ‰å€¼å¾—å¾ˆæ·±å…¥çš„ç‚¹ã€‚</p>
<p>æœ€åæ„Ÿè§‰è·Ÿç€å¤§ç¥ä»¬å­¦ä¹ æ„Ÿè§‰å¾ˆä¸é”™å‘€ï¼Œå“ˆå“ˆå˜»ğŸ˜Šï¼</p>
 <a id="more"></a>
<h1 id="ä»€ä¹ˆæ˜¯Promise"><a href="#ä»€ä¹ˆæ˜¯Promise" class="headerlink" title="ä»€ä¹ˆæ˜¯Promise?"></a>ä»€ä¹ˆæ˜¯Promise?</h1><p>Promiseå¯¹è±¡æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆä»£ç†ä¸€ä¸ªå€¼ï¼‰ã€‚è¢«ä»£ç†çš„å€¼åœ¨Promiseåˆ›å»ºçš„æ—¶å€™å¯èƒ½æ˜¯æœªçŸ¥çš„ã€‚å®ƒå…è®¸ä½ ä¸ºå¼‚æ­¥æ“ä½œçš„æˆåŠŸä¸å¤±è´¥åˆ†åˆ«ç»‘å®šç›¸åº”çš„å¤„ç†æ–¹æ³•ã€‚è¿™è®©å¼‚æ­¥å¯ä»¥åƒåŒæ­¥æ–¹æ³•é‚£æ ·è¿”å›å€¼ï¼Œä½†å¹¶ä¸æ˜¯ç«‹å³è¿”å›æœ€ç»ˆçš„æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½ä»£è¡¨æœªæ¥çš„å‡ºç°çš„ç»“æœçš„promiseå¯¹è±¡ã€‚</p>
<h1 id="promiseçš„çŠ¶æ€"><a href="#promiseçš„çŠ¶æ€" class="headerlink" title="promiseçš„çŠ¶æ€"></a>promiseçš„çŠ¶æ€</h1><p>Promise ä¸€ç§æœ‰ä¸‰ç§å€¼çš„çŠ¶æ€ï¼š <strong>pending(è¿›è¡Œä¸­)</strong>, <strong>fulfiiled(å·²æˆåŠŸ)</strong>ï¼Œ<strong>rejected(å·²å¤±è´¥)â€˜</strong></p>
<h1 id="Promiseçš„ç‰¹ç‚¹"><a href="#Promiseçš„ç‰¹ç‚¹" class="headerlink" title="Promiseçš„ç‰¹ç‚¹"></a>Promiseçš„ç‰¹ç‚¹</h1><ul>
<li><p><strong>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œçš„å½±å“</strong></p>
<p>åªæœ‰å¼‚æ­¥çš„ç»“æœå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼ˆpendingï¼Œ fulfilled, rejectedï¼‰ã€‚ å…¶ä»–çš„æ‰‹æ®µéƒ½æ˜¯æ— æ³•æ”¹å˜çš„ã€‚</p>
</li>
<li><p><strong>ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥æ‹¿åˆ°è¿™ä¸ªçŠ¶æ€</strong></p>
<p>Promiseçš„çŠ¶æ€åªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»pending åˆ° fulfilledï¼Œ ä»peding åˆ°rejectedã€‚åªè¦è¿™ä¸¤ç§å‘ç”Ÿäº†ï¼ŒçŠ¶æ€ä¹Ÿå°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ã€‚</p>
<p>å¦‚æœåœ¨å¯¹Promiseå¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹åˆ»æ‹¿åˆ°è¿™ä¸ªç»“æœã€‚</p>
</li>
</ul>
<h1 id="åˆ›å»ºPromise"><a href="#åˆ›å»ºPromise" class="headerlink" title="åˆ›å»ºPromise"></a>åˆ›å»ºPromise</h1><p>åˆ›å»ºPromiseå¯¹è±¡ï¼Œä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>new Promise()</code>æ¥åˆ›å»ºä¸€ä¸ª<code>promise</code>(å³<code>new Promise()</code>æ„é€ å™¨)</li>
<li><p>ä½¿ç”¨ç±»æ–¹æ³•Promise.xxx()-â€”â€”<code>Promise.all()</code>ï¼Œ<code>Promise.race()</code>ï¼Œ<code>Promise.allsettled()</code>ï¼Œ<code>Promise.any()</code>ï¼Œ<code>Promise.resolve()</code>ï¼Œ<code>Promise.reject()</code></p>
</li>
<li><p>ä½¿ç”¨åŸå‹å½¢æ–¹æ³•<code>Promise.prototype.xxx()</code>â€”â€”<code>promise.then()</code>ï¼Œ<code>promise.catch()</code>ï¼Œ<code>promise.fanally()</code>éƒ½å°†è¿”å›ä¸€ä¸ªæ–°çš„promise</p>
<blockquote>
<p>ä»»ä½•æ–¹æ³•å¾—åˆ°çš„<code>promise</code>å¯¹è±¡éƒ½å…·æœ‰<code>.then</code>ï¼Œ<code>.catch</code>ç­‰æ–¹æ³•ï¼Œä¹Ÿæ˜¯<code>Promise.prototype.xxx</code>çš„åŸå‹æ–¹æ³•ï¼Œ<code>Javascript</code>è°ƒç”¨è¿™äº›æ–¹æ³•å°†ç»å¯¹ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸Šé¢ç¬¬ä¸‰ç§å¾—åˆ°ä¸€ä¸ªæ–°çš„<code>promise</code>å¯¹è±¡çš„æ–¹æ³•</p>
</blockquote>
</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong>ä»»ä½•ä¸€ç§æ–¹æ³•éƒ½æ˜¯ç«‹å³å¾—åˆ°<code>promise</code>å¯¹è±¡çš„</p>
<h1 id="Promiseçš„æ„é€ æ–¹æ³•"><a href="#Promiseçš„æ„é€ æ–¹æ³•" class="headerlink" title="Promiseçš„æ„é€ æ–¹æ³•"></a>Promiseçš„æ„é€ æ–¹æ³•</h1><p><code>Promise</code>é€šå¸¸ä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ„é€ å™¨æ¥è®©ç”¨æˆ·æ–¹ä¾¿çš„åˆ›å»º<code>promise</code>å¯¹è±¡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºpromiseå¯¹è±¡çš„æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(executor);</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦ç”¨æˆ·å£°æ˜çš„æ‰§è¡Œå‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> executor = <span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç çš„<code>executor</code> æ˜¯ç”¨æˆ·å£°æ˜çš„æ‰§è¡Œå‡½æ•°ï¼Œå½“<code>JavaScript</code>å¼•æ“é€šè¿‡new è¿ç®—ç¬¦æ¥åˆ›å»º<code>promise</code>å¯¹è±¡æ—¶ï¼Œå®ƒäº‹å®ä¸Šåœ¨è°ƒç”¨<code>executor()</code>ä¹‹å‰å°±åˆ›å»ºå¥½ä¸€ä¸ªæ–°çš„<code>promise</code>å¯¹è±¡çš„å®ä¾‹ï¼Œå¹¶ä¸”å¾—åˆ°å…³è”ç»™è¿™ä¸ªå®ä¾‹çš„ä¸¤ä¸ªç½®å€¼å™¨ï¼š<code>resolve()</code>ï¼Œ<code>reject()</code>å‡½æ•°ï¼Œç„¶åï¼Œå®ƒä¼šè°ƒç”¨<code>executor()</code>ï¼Œå¹¶ä¸”æŠŠè¿™ä¸¤ä¸ªç½®å€¼å™¨ä½œä¸ºå…¥å£å‚æ•°ä¼ å…¥ï¼Œè€Œ<code>executor()</code>å‡½æ•°ä¼šè¢«æ‰§è¡Œç›´åˆ°é€€å‡ºã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong><code>executor()</code>å‡½æ•°å¹¶ä¸é€šè¿‡é€€å‡ºæ—¶æ‰€è¿”å›çš„å€¼æ¥å¯¹ç³»ç»Ÿé€ æˆå½±å“â€”â€”è¯¥è¿”å›å€¼å°†ä¼šè¢«å¿½ç•¥ï¼ˆæ— è®ºæ˜¯æ˜¾å¼è¿”å›ç»“æœï¼Œè¿˜æ˜¯é»˜è®¤è¿”å›å€¼<code>undefined</code>ï¼‰ã€‚<code>executor()</code>ä¸­çš„ç”¨æˆ·ä»£ç å¯ä»¥åˆ©ç”¨ä¸Šè¿°çš„ä¸¤ä¸ªç½®å€¼å™¨ï¼Œæ¥å‘<code>promise</code>å¯¹è±¡â€œä»£ç†çš„é‚£ä¸ªæ•°æ®â€ç½®å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸º<code>promise</code>ç»‘å®šå€¼çš„è¿‡ç¨‹æ˜¯ç”±ç”¨æˆ·ä»£ç æ¥è§¦å‘çš„ã€‚è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥åƒâ€è®©ç”¨æˆ·ä»£ç å›è°ƒ<code>JavaScript</code>å¼•æ“â€ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨æˆ·ä»£ç é€šè¿‡resolve(æˆ–rejectï¼‰æ¥å›è°ƒå¼•æ“ä»¥ç½®å€¼</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">"shuliqi"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š<code>executor()</code></strong>å‡½æ•°ä¸­çš„<code>resolve</code>Â·ç½®å€¼å™¨å¯ä»¥æ¥å—ä»»ä½•å€¼ï¼ˆé™¤äº†å½“å‰çš„promiseæœ¬èº«ä¹‹å¤–ï¼‰,å¦‚æœä½¿ç”¨è‡ªèº«æ¥ç½®å€¼æ—¶ï¼Œ<code>JavaScript</code>ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æš‚å­˜resolveç½®å€¼çš„å˜é‡</span></span><br><span class="line"><span class="keyword">let</span> delayResolve;</span><br><span class="line"> <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    delayResolve = resolve;</span><br><span class="line"> &#125;);</span><br><span class="line"><span class="comment">// å°è¯•ä½¿ç”¨è‡ªèº«æ¥ç½®å€¼</span></span><br><span class="line"> delayResolve(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœï¼šTypeError: Chaining cycle detected for promise #&lt;Promise&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="æ„å»ºPromiseå¯¹è±¡ï¼šæ²¡æœ‰å»¶è¿Ÿ"><a href="#æ„å»ºPromiseå¯¹è±¡ï¼šæ²¡æœ‰å»¶è¿Ÿ" class="headerlink" title="æ„å»ºPromiseå¯¹è±¡ï¼šæ²¡æœ‰å»¶è¿Ÿ"></a>æ„å»ºPromiseå¯¹è±¡ï¼šæ²¡æœ‰å»¶è¿Ÿ</h1><p>åœ¨æ„å»ºæ•´ä¸ª<code>Promise</code>å¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œ æ˜¯æ²¡æœ‰ä»»ä½•çš„å»¶è¿Ÿçš„ã€‚<code>Promise</code>æœºåˆ¶ä¸­æ²¡æœ‰å»¶è¿Ÿï¼Œ ä¹Ÿæ²¡æœ‰è¢«å»¶è¿Ÿçš„è¡Œä¸ºï¼Œæ›´æ²¡æœ‰å¯¹â€æ—¶é—´â€è¿™ä¸ªç»´åº¦è¿›è¡Œæ§åˆ¶ã€‚å› æ­¤<code>JavaScript</code>ä¸­åˆ›å»ºä¸€ä¸ª<code>promise</code>æ—¶ï¼Œåˆ›å»ºè¿‡ç¨‹æ—¶ç«‹å³å®Œæˆçš„ï¼›ä½¿ç”¨åŸå‹çš„æ–¹æ³•<code>promise.xxx</code>æ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„<code>promise</code>æ—¶ä¹Ÿæ˜¯ç«‹å³å®Œæˆçš„ã€‚æ‰€æœ‰<code>promise</code>å¯¹è±¡éƒ½æ˜¯åœ¨ä½ éœ€è¦çš„æ—¶å€™ç«‹å³å°±ç”Ÿæˆçš„ã€‚</p>
<p>åªä¸è¿‡é‡è¦çš„æ˜¯â€”-&gt;<strong>è¿™äº›<code>promise</code>æ‰€ä»£ç†çš„é‚£ä¸ªå€¼/æ•°æ®è¿˜æ²¡æœ‰â€œå°±ç»ªâ€ã€‚è¿™ä¸ªå°±ç»ªçš„è¿‡ç¨‹è¦æ¨è¿Ÿåˆ°â€œæœªçŸ¥çš„å°†æ¥â€æ‰ä¼šå‘ç”Ÿï¼Œè€Œä¸€æ—¦æ•°æ®å°±ç»ªï¼Œpromise.then(fun)ä¸­çš„funå°±ä¼šè¢«è§¦å‘äº†</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'shuliqi'</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(<span class="string">'1'</span>), <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åªè¦æˆ‘ä»¬åˆ›å»ºäº†<code>promise</code> å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç«‹å³çš„ï¼Œæ‰€ä»¥ç«‹é©¬è¾“å‡ºâ€œshuliqiâ€ã€‚ç„¶åè¿‡3ç§’ï¼Œè¾“å‡º â€œ1â€ã€‚</p>
<h1 id="Then-é“¾"><a href="#Then-é“¾" class="headerlink" title="Then é“¾"></a>Then é“¾</h1><p>ä¸¤ä¸ª<code>Promise</code>å¯¹è±¡ä¹‹é—´é¡ºåºæ‰§è¡Œçš„å…³ç³»ï¼Œåœ¨<code>JavaScript</code>ä¸­ç§°ä¸ºâ€œThen é“¾â€ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªPromise å¯¹è±¡P</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'shuliqi'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// é€šè¿‡p.then()æ¥å¾—åˆ°æ–°çš„promiseå¯¹è±¡ p2</span></span><br><span class="line"><span class="keyword">const</span> p2 = p.then(foo() =&gt; &#123;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è°ƒç”¨<code>p.then(</code>)çš„æ–¹å¼æ¥çº¦å®šå½“å‰çš„<code>promise</code>å¯¹è±¡ä¸ä¸‹ä¸€ä¸ª<code>promise</code>å¯¹è±¡ä¹‹é—´çš„â€œé“¾â€å…³ç³»ï¼Œå¹¶ä¸”è¿™äº‹å®ä¸Šä¹Ÿä¹Ÿä»£è¡¨äº†å®ƒä»¬ä¹‹å‰çš„é¡ºåºæ‰§è¡Œçš„å…³ç³»ï¼ˆ<strong>æ‰€è°“çš„â€œé¡ºåºæ‰§è¡Œâ€æ˜¯æŒ‡å®ƒä»¬çš„ç½®å€¼é€»è¾‘ä»¥åŠè§¦å‘çš„è¡Œä¸ºä¹‹é—´çš„å…³ç³»â€”-&gt; å› ä¸ºPromiseæœ¬èº«æ˜¯æ•°æ®çš„ä»£ç†æ‰€ä»¥å¹¶ä¸æ˜¯æ‰§è¡Œä½“</strong>ï¼‰ã€‚</p>
<p>å¹¶ä¸”thené“¾æ˜¯Promiseæœºåˆ¶çš„åŸºæœ¬ç”¨æ³•å’Œå…³é”®çš„æœºåˆ¶ã€‚ä¸Šé¢ä¾‹å­ä¸­çš„p.then()ä»£è¡¨äº†å¯¹é¡ºåºçš„é€»è¾‘çš„ç†è§£ï¼Œ åŒæ—¶å®ƒä¹Ÿéšå«çš„è¯´æ˜ï¼šp2 ä¸p1ä¸¤è€…æ‰€ä»£ç†çš„æ•°æ®ä¹‹é—´æ˜¯æœ‰å…³è”çš„ã€‚è¿™ä¸ªä¾‹å­çš„foo()å‡½æ•°æ˜¯ä½œä¸ºp1çš„æˆåŠŸå›è°ƒï¼Œå¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­çš„ä½œä¸ºonFulfilledå‚æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªPromise å¯¹è±¡P</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'shuliqi'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// é€šè¿‡p.then()æ¥å¾—åˆ°æ–°çš„promiseå¯¹è±¡ p2</span></span><br><span class="line"><span class="keyword">const</span> p2 = p.then(onFulfilled, onRejected);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onFulfilled</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(value); <span class="comment">// shuliqi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onRejected</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å½“å‰çš„promiseæ•°æ®å°±ç»ªæ—¶ï¼ŒJavaScriptå°±å°†æ ¹æ®å°±ç»ªçŠ¶æ€ç«‹å³å‡ºå‘æœ‰p.then()æ–¹æ³•æ‰€å…³è”çš„onFulfilled/ onRejectedä¹‹ä¸€ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°<strong>é€€å‡ºæ—¶è¿”å›çš„å€¼</strong>æˆ–è€…<strong>ç»ˆæ­¢æ‰§è¡Œæ—¶çš„çŠ¶æ€</strong>ä½œä¸ºå€¼æ¥è°ƒç”¨p2</p>
<p>p.then()å®é™…ä¸Šæ˜¯Promise.prototype.thenè¿™ä¸ªåŸå‹çš„æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯å®Œæˆä¸‰ä»¶äº‹ï¼š</p>
<ul>
<li>åˆ›å»ºæ–°çš„promise2å¯¹è±¡</li>
<li>ç™»è®°å½“å‰promise ä¸ promise2 ä¹‹é—´çš„å…³ç³»ï¼ˆé¡ºåºæ‰§è¡Œçš„å…³ç³»å’Œä»£ç†çš„æ•°æ®ä¹‹é—´æ˜¯æœ‰å…³è”çš„ï¼‰</li>
<li>å°†onFulfilled ï¼ŒonRejectedå…³è”ç»™promise2 çš„resolveç½®å€¼å™¨ï¼Œå¹¶ä¸”ç¡®ä¿æ—©promise1çš„æ•°æ®å°±ç»ªæ—¶è°ƒç”¨onFulfilledï¼Œ onRejectedã€‚</li>
</ul>
<h2 id="promise1çš„ç½®å€¼é€»è¾‘"><a href="#promise1çš„ç½®å€¼é€»è¾‘" class="headerlink" title="promise1çš„ç½®å€¼é€»è¾‘"></a>promise1çš„ç½®å€¼é€»è¾‘</h2><p>æ‰€ä»¥åœ¨æ„å»ºpromiseçš„æ‰§è¡Œå™¨ä¸­ï¼Œå¯ä»¥å‘resolve/reject ä¼ å…¥ä»»æ„çš„JavaScriptæ•°æ®ç±»å‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    resolve(<span class="string">'æˆ‘æ˜¾ç¤ºä½¿ç”¨resolveç½®å€¼å™¨ç½®å€¼'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    reject(<span class="string">'æˆ‘æ˜¾ç¤ºä½¿ç”¨reject ç½®å€¼å™¨ç½®å€¼'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­æ˜¾å¼çš„ä½¿ç”¨resolve / reject ç½®å€¼å™¨æ¥ç½®å€¼ã€‚</p>
<p>å¦‚æœæ‰§è¡Œå™¨åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­è§¦å‘å¼‚å¸¸ï¼ŒjavaScriptå¼•æ“ä¹Ÿå°†è°ƒç”¨rejectï¼Œ å¹¶ä¸”æŠŠå¼‚å¸¸ä½œä¸ºreasonã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(); <span class="comment">// åˆ›å»ºå¼‚å¸¸ï¼Œå¹¶ä¸”æŠ›å‡ºï¼Œç›¸å½“äºreject(new Error())</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œå¦‚æœåœ¨å®ƒçš„then é“¾ä¸Šæœ‰promise2,é‚£ä¹ˆå¦‚å‰æ‰€è¯‰ï¼šonFulfilled/onRejectedå°†è¢«è§¦å‘ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    resolve(<span class="string">'æˆ‘æ˜¾ç¤ºä½¿ç”¨resolveç½®å€¼å™¨ç½®å€¼'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    reject(<span class="string">'æˆ‘æ˜¾ç¤ºä½¿ç”¨reject ç½®å€¼å™¨ç½®å€¼'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 =p.then(onFulfilled, onRejected);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onFulfilled</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯resolveç½®å€¼å™¨ç½®å€¼æˆåŠŸçš„å›è°ƒ'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onRejected</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æˆ‘æ˜¯rejectç½®å€¼å™¨ç½®å€¼æˆ–è€…æ˜¯resolveç½®å€¼å™¨ç½®å€¼å¤±è´¥çš„å›è°ƒ"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// æˆ‘æ˜¯resolveç½®å€¼å™¨ç½®å€¼æˆåŠŸçš„å›è°ƒ</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(); <span class="comment">// åˆ›å»ºå¼‚å¸¸ï¼Œå¹¶ä¸”æŠ›å‡ºï¼Œç›¸å½“äºreject(new Error())</span></span><br><span class="line">  &#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 =p.then(resolved, rejected);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolved</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯resolveç½®å€¼å™¨ç½®å€¼æˆåŠŸçš„å›è°ƒ'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rejected</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æˆ‘æ˜¯rejectç½®å€¼å™¨ç½®å€¼æˆ–è€…æ˜¯resolveç½®å€¼å™¨ç½®å€¼å¤±è´¥çš„å›è°ƒ"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// æˆ‘æ˜¯rejectç½®å€¼å™¨ç½®å€¼æˆ–è€…æ˜¯resolveç½®å€¼å™¨ç½®å€¼å¤±è´¥çš„å›è°ƒ</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„çš„ resolvedï¼Œ rejected éƒ½åªæ˜¯ p çš„çŠ¶æ€ï¼Œä»–ä»¬åªæ˜¯promise2çš„ç½®å€¼å‰æè€Œå·²ï¼Œ é‚£ä¹ˆpromise2çš„ç½®å€¼é€»è¾‘æ˜¯å•¥å‘¢ï¼Ÿ</p>
<h2 id="promise2çš„ç½®å€¼é€»è¾‘"><a href="#promise2çš„ç½®å€¼é€»è¾‘" class="headerlink" title="promise2çš„ç½®å€¼é€»è¾‘"></a>promise2çš„ç½®å€¼é€»è¾‘</h2><p>ä¸€ä¸ªPromiseå¯èƒ½è¢«ç½®å…¥ä¸¤ç§å€¼ä¹‹ä¸€ï¼ˆå¹¶ä¸”ä¸€æ—¦ç½®å€¼å°†ä¸å¯æ”¹å˜ï¼Œç§°ä¸ºâ€œç»ˆæ€â€ï¼‰ï¼Œè¿™ä¸¤ç§å€¼æ—¶æŒ‡ï¼š</p>
<ul>
<li>å¦‚æœpromise è¢« resolveç½®å€¼å™¨ç½®å€¼æˆåŠŸï¼Œåˆ™è¯¥å€¼ç§°ä¸ºæœ‰æ•ˆå€¼ï¼ˆvalueï¼‰</li>
<li>å¦‚æœpromise è¢« rejectç½®å€¼å™¨ç½®å€¼ æˆ–è€… resolveç½®å€¼å™¨ç½®å€¼ å¤±è´¥ï¼Œåˆ™è¯¥å€¼ç”¨äºè®°å½•åŸå› ï¼ˆreasonï¼‰ã€‚</li>
</ul>
<p><strong>æ— è®ºrejectedï¼Œrejectedå‡½æ•°æ— è®ºè¿”å›ä½•å€¼ï¼Œéƒ½å°†ä½œä¸ºresolveå€¼ç›´æ¥ç»‘å®šç»™promise2</strong>(å³ï¼šresolved, rejectedå‡½æ•°ä¼šå…³è”åœ¨promise2çš„resolve å€¼å€¼å™¨ä¸Š)</p>
<p>promise2 çš„ç½®å€¼é€»è¾‘ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä¸Šä¸€ä¸ªpromiseçš„ç½®å€¼çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (isRejected(p)) &#123;</span><br><span class="line">        x2 = rejected(result);  <span class="comment">// æ‰§è¡Œrejectedå‡½æ•°ï¼Œresultä¸ºreasonï¼ˆresultæ˜¯pä»£ç†çš„æ•°æ®ï¼‰</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        x2 = resolved(result); <span class="comment">// æ‰§è¡Œresolvedå‡½æ•°</span></span><br><span class="line">    &#125; </span><br><span class="line">    resolve(x2); <span class="comment">// promise2</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    reject(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolvedForP1 = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> rejectedForP1 = <span class="function"><span class="keyword">function</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> reason;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> resolvedForP2 = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯p2 resolvedçŠ¶æ€,'</span>, value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> rejectedForP2= <span class="function"><span class="keyword">function</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯p2 rejectedçŠ¶æ€,'</span>, reason);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// é¡ºä¾¿è°ƒç”¨p1çš„resolveç½®å€¼å™¨ï¼Œè¿˜æ˜¯rejectç½®å€¼å™¨</span></span><br><span class="line">      <span class="comment">// resolve('p1 resolve');</span></span><br><span class="line">      reject(<span class="string">'p1 reject'</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = p1.then(resolvedForP1, rejectedForP1);</span><br><span class="line">p2.then(resolvedForP2, rejectedForP2)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// æˆ‘æ˜¯p2 resolvedçŠ¶æ€, p1 reject</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ï¼š æ— è®ºp1 æˆ‘è°ƒç”¨çš„æ˜¯ resolve ç½®å€¼å™¨è¿˜æ˜¯æ‹ï¼Œå¯¼è‡´æ— è®ºè°ƒç”¨ resolvedForP1è¿˜æ˜¯ rejectedForP1ï¼Œè¿”å›å€¼éƒ½æ˜¯ä½œä¸ºresolveå€¼ç»‘å®šç»™p2ã€‚</p>
<p>è°ƒç”¨ï¼ˆp1  reject ç½®å€¼å™¨ â€”-&gt; è°ƒç”¨rejectedForP1 â€”-&gt; rejectedForP1 è¿”å›å€¼ â€”-&gt; é€šè¿‡p2 çš„resolveç½®å€¼å™¨ç›´æ¥ç»‘å®šç»™p2ï¼‰ã€‚</p>
<p>æ³¨æ„ï¼š<strong>è¿™ä¸æ˜¯å®Œæˆçš„promise2 çš„ç½®å€¼é€»è¾‘</strong>ï¼Œ å®Œæ•´çš„è¯·å¾€ä¸‹çœ‹ã€‚</p>
<h2 id="then-é“¾ä¸­â€œäº§ç”Ÿâ€-rejectå€¼çš„æ–¹æ³•"><a href="#then-é“¾ä¸­â€œäº§ç”Ÿâ€-rejectå€¼çš„æ–¹æ³•" class="headerlink" title="then é“¾ä¸­â€œäº§ç”Ÿâ€ rejectå€¼çš„æ–¹æ³•"></a>then é“¾ä¸­â€œäº§ç”Ÿâ€ rejectå€¼çš„æ–¹æ³•</h2><p>åœ¨then é“¾ä¸­â€œäº§ç”Ÿâ€ rejectå€¼çš„æ–¹æ³•åªæœ‰ä¸¤ç§ï¼š</p>
<ul>
<li><p>é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ä½¿å¾—JavaScriptå¼•æ“æ•è·å¼‚å¸¸å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'æˆ‘æ˜¯èˆ’ä¸½ç¦'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// æ–¹æ³•1: é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ä½¿å¾—JavaScriptå¼•æ“æ•è·å¼‚å¸¸å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> p2 = p1.then(<span class="function">(<span class="params">value</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ä½¿å¾—JavaScriptå¼•æ“æ•è·å¼‚å¸¸å¯¹è±¡'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">p2.then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// UnhandledPromiseRejectionWarning: Error: é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ä½¿å¾—JavaScriptå¼•æ“æ•è·å¼‚å¸¸å¯¹è±¡....</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡æ˜¾å¼çš„è°ƒç”¨Promise.reject()ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'æˆ‘æ˜¯èˆ’ä¸½ç¦'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// æ–¹æ³•2: æ˜¾å¼çš„è°ƒç”¨Promise.reject() </span></span><br><span class="line"><span class="keyword">const</span> p2 = p1.then(<span class="function">(<span class="params">value</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Promise</span>.reject(<span class="string">'æ˜¾å¼çš„è°ƒç”¨Promise.reject() '</span>)</span><br><span class="line">&#125;);</span><br><span class="line">p2.then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// UnhandledPromiseRejectionWarning: æ˜¾å¼çš„è°ƒç”¨Promise.reject() ...</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Then-é“¾å¯¹å€¼çš„ä¼ é€’"><a href="#Then-é“¾å¯¹å€¼çš„ä¼ é€’" class="headerlink" title="Then é“¾å¯¹å€¼çš„ä¼ é€’"></a>Then é“¾å¯¹å€¼çš„ä¼ é€’</h2><p>å¦‚æœpromise2 çš„resolve å¹¶æ²¡æœ‰å…³è”æœ‰æ•ˆçš„resolvedï¼Œrejected å‘¢ï¼Ÿ æˆ–è€… promise2 æ ¹æœ¬æ²¡æœ‰resolvedï¼Œ rejected å‡½æ•°å‘¢ï¼Ÿé‚£ä¹ˆè¿˜ä¼šç”Ÿæˆpromise2 å—ï¼Ÿ å¦‚æœç”Ÿæˆï¼Œ é‚£ä¹ˆå®ƒçš„å€¼æ—¶ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼š<strong>å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„å“åº”å‡½æ•°ä»ä¼šäº§ç”Ÿæ–°çš„promise2, å¹¶ä¸”å®ƒçš„resolve å°†ä»¥then é“¾ä¸­çš„å½“å‰çš„promiseçš„å€¼ä¸ºå€¼</strong>ï¼Œ</p>
<p>å› æ­¤promise2 çš„å®Œæ•´çš„ä¼ªç½®å€¼é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä¸Šä¸€ä¸ªpromiseçš„ç½®å€¼çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (isRejected(p)) &#123;</span><br><span class="line">       <span class="comment">// rejected æ˜¯æœ‰æ•ˆçš„ ? æ‰§è¡Œrejectedå‡½æ•°ï¼Œresultä¸ºreason : result </span></span><br><span class="line">       <span class="comment">// å…¶ä¸­resultæ˜¯pä»£ç†çš„æ•°æ®</span></span><br><span class="line">        x2 = isValidHandler(rejected) ? rejected(result) :<span class="keyword">throw</span> result;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	  <span class="comment">// resolvedå‡½æ•°æ˜¯æœ‰æ•ˆçš„ ï¼Ÿ æ‰§è¡Œresolvedå‡½æ•° ï¼š result;</span></span><br><span class="line">        x2 = isValidHandler(resolve) : resolved(result) : result; </span><br><span class="line">    &#125; </span><br><span class="line">    resolve(x2); <span class="comment">// promise2</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    reject(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥ä¸¾ä¾‹å­æ£€æµ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="string">'è°ƒç”¨p1çš„rejectç½®å€¼å™¨ç½®å€¼'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = p1.then();</span><br><span class="line">p2.then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// UnhandledPromiseRejectionWarning: è°ƒç”¨p1çš„rejectç½®å€¼å™¨ç½®å€¼...</span></span><br></pre></td></tr></table></figure>
<p>P1ä»£ç†çš„å€¼æ˜¯reject ç½®å€¼å™¨ç½®å€¼çš„ï¼Œåœ¨åˆ›å»ºp2çš„æ—¶å€™ï¼Œ rejected å‡½æ•°ä¸å­˜åœ¨(æ— æ•ˆ), åˆ™æŠ›å‡ºå¼‚å¸¸, å€¼ä¸ºå½“å‰promise(p1)çš„å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'è°ƒç”¨p1çš„rejectç½®å€¼å™¨ç½®å€¼'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = p1.then();</span><br><span class="line">p2.then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// è°ƒç”¨p1çš„rejectç½®å€¼å™¨ç½®å€¼</span></span><br></pre></td></tr></table></figure>
<p>P1ä»£ç†çš„å€¼æ˜¯resolveç½®å€¼å™¨ç½®å€¼çš„ï¼Œåœ¨åˆ›å»ºp2çš„æ—¶å€™ï¼Œ resolvedå‡½æ•°ä¸å­˜åœ¨(æ— æ•ˆ), åˆ™ç›´æ¥è¿”å›å½“å‰promise(p1)çš„å€¼ã€‚</p>
<h2 id="Then-é“¾-catch-çš„å¤„ç†"><a href="#Then-é“¾-catch-çš„å¤„ç†" class="headerlink" title="Then é“¾ catch() çš„å¤„ç†"></a>Then é“¾ catch() çš„å¤„ç†</h2><p>promise2çš„ç½®å€¼è¿‡ç¨‹ä¹Ÿè§£é‡Šäº†ä½¿ç”¨.catchä½œä¸ºthené“¾ç»“å°¾çš„åŸå› ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="string">'è°ƒç”¨p1çš„rejectç½®å€¼å™¨ç½®å€¼'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = p1.then();</span><br><span class="line"><span class="keyword">const</span> p3 = p2.then();</span><br><span class="line">p3.catch(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(reason)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// UnhandledPromiseRejectionWarning: è°ƒç”¨p1çš„rejectç½®å€¼å™¨ç½®å€¼</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä»»æ„é•¿çš„thené“¾ä¸­ï¼Œå¦‚æœé“¾çš„å‰ç«¯å‡ºç°äº†rejected å€¼ï¼Œæ— è®ºç»è¿‡å¤šå°‘çº§.then()å“åº”(åªæœ‰onFulfilledå“åº”è€Œæ²¡æœ‰å¤„ç†)ï¼Œ æœ€ç»ˆrejected å€¼éƒ½èƒ½å¤ŸæŒç»­å‘åä¼ é€’å¹¶ä¸”è¢«é“¾å°¾çš„.catch()å“åº”åˆ°ã€‚è¿™ä¹Ÿå°±æ˜¯Promiseæœºåˆ¶çš„ç¬¬ä¸€åŸåˆ™ï¼š<strong>å§‹äºPromiseï¼Œ ç»ˆäºcatch</strong>ã€‚</p>
<h1 id="Promiseçš„ç±»æ–¹æ³•"><a href="#Promiseçš„ç±»æ–¹æ³•" class="headerlink" title="Promiseçš„ç±»æ–¹æ³•"></a>Promiseçš„ç±»æ–¹æ³•</h1><p>Promise()ç±»æ–¹æ³•Promise.xxxä¸»è¦ä½œç”¨äºè·å¾—ä¸€ä¸ªpromise</p>
<p>promiseç±»æ–¹æ³•æœ‰å››ä¸ªï¼š</p>
<ul>
<li><p><strong>Promise.resolve()</strong></p>
</li>
<li><p><strong>Promise.reject()</strong></p>
</li>
<li><p><strong>Promise.all()</strong></p>
</li>
<li><p><strong>Promise.race()</strong></p>
</li>
</ul>
<h2 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve()"></a>Promise.resolve()</h2><p>Pomiseç±»æ–¹æ³•resolve()æ˜¯è¦å¾—åˆ°ä¸€ä¸ªresolved çš„ promiseã€‚å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve(x)</span><br></pre></td></tr></table></figure>
<p>xæ˜¯ä»»æ„å€¼ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™æ˜¯undefined</p>
<ul>
<li><p>å¦‚æœ x æ˜¯Promiseçš„ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆPromise.resolve(x)ï¼Œ å°†ä¸ä¼šäº§ç”Ÿæ–°çš„è®¡ç®—ç»“æœï¼Œè€Œæ˜¯ç›´æ¥è¿”å›xè¿™ä¸ªå®ä¾‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve(x);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="built_in">Promise</span>.resolve(p)</span><br><span class="line"><span class="comment">// p ä¸ p2 æ˜¯ç›¸åŒçš„promise</span></span><br><span class="line"><span class="built_in">console</span>.log(p === p2); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// resolveçš„å€¼æ˜¯åŒä¸€ä¸ª</span></span><br><span class="line">p2.then(<span class="function">(<span class="params">value</span>) =&gt;</span>  <span class="built_in">console</span>.log(value === x)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœxæ˜¯ä¸€ä¸ªthenable</p>
<p>thenableå¯¹è±¡ï¼šæŒ‡ä»»æ„å¸¦æœ‰.then()æ–¹æ³•çš„å¯¹è±¡ã€‚å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> thenable = &#123;</span><br><span class="line">   then: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯thenableå¯¹è±¡'</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> thenable = &#123;</span><br><span class="line">  then: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯thenableå¯¹è±¡'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve(thenable);</span><br><span class="line"><span class="comment">// æˆ‘æ˜¯thenableå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(thenable === p); </span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>x.then()æ˜¯ç«‹å³æ‰§è¡Œäº†ï¼Œ ä½†æ˜¯è¿™ä¸ªthenableå¯¹è±¡ä¸æœ€ç»ˆçš„pæ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥ç›®å‰è¿™ä¸ªæ‰§è¡Œè¿‡ç¨‹æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ã€‚å› ä¸ºè¿™ä¸ªthenableå¯¹è±¡ä¸æœ€ç»ˆçš„på¯¹åƒä¹‹é—´å¹¶æ²¡æœ‰å»ºç«‹å…³ç³»ã€‚ä¸ºä»€ä¹ˆæ²¡æœ‰å»ºç«‹å…³ç³»å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºJavaScriptæ˜¯è¯•å›¾å°†x.then()ä½œä¸ºä¸€ä¸ªâ€œç±»ä¼¼new Promise()ä¸­çš„æ‰§è¡Œå™¨ï¼ˆexecutorï¼‰â€æ¥ä½¿ç”¨çš„ã€‚Promise.resolve(tenable)å¯¼è‡´.then() è¢«æ‰§è¡Œæ—¶ï¼Œpè¿™ä¸ªpromiseå¯¹è±¡çš„resolveä¸rejectä¸¤ä¸ªç½®å€¼å™¨è¢«ä½œä¸º.then()çš„å‚æ•°ä¼ å…¥çš„ï¼Œå› æ­¤(ä¸new Promiseç±»ä¼¼)ï¼Œç”¨æˆ·ä»£ç éœ€è¦åœ¨.then(resolve,reject)è°ƒç”¨è¿™ä¸¤ä¸ªç½®å€¼å™¨æ‰èƒ½çœŸæ­£çš„å»ºç«‹thenableä¸pä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>æ‰€ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œpå¯¹è±¡ä¸thenableæ‰çœŸæ­£å»ºç«‹èµ·äº†å…³ç³»ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> thenable = &#123;</span><br><span class="line">    then: <span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ˜¯thenableå¯¹è±¡'</span>);</span><br><span class="line">        resolve(<span class="string">'shuliqi'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve(thenable);</span><br><span class="line">p.then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// æˆ‘æ˜¯thenableå¯¹è±¡</span></span><br><span class="line"><span class="comment">// shuliqi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœxæ˜¯ä¸€ä¸ªrejectedçš„promiseå¯¹è±¡ï¼Œé‚£ä¹ˆProject.resolve(xå°†ä¼šæ˜¯ä¸€ä¸ªrejectedçŠ¶æ€çš„promiseå¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="string">'rejectedçŠ¶æ€'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="built_in">Promise</span>.resolve(p);</span><br><span class="line">p2.then().catch(<span class="function">(<span class="params">reason</span>) =&gt;</span> <span class="built_in">console</span>.log(reason));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// rejectedçŠ¶æ€</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>xä»¥ä¸Šæƒ…å†µéƒ½ä¸æ˜¯ï¼Œé‚£ä¹ˆå°†ä¼šè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ç›´æ¥ä¸ºresolvedçš„promiseå¯¹åƒï¼Œå¹¶ä¸”ä»£ç†çš„æ•°æ®ä¸xçš„ç›¸åŒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="string">"shuliqi"</span>;</span><br><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve(x);</span><br><span class="line">p.then(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'resolvedçŠ¶æ€çš„'</span>, value));</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">//resolvedçŠ¶æ€çš„, shuliqi</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve();</span><br><span class="line">  p.then(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"resolvedçŠ¶æ€çš„"</span>));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  ä¸Šé¢è¿™ä¸¤ä¸ªä¾‹å­éƒ½æ˜¯è°ƒç”¨äº†resoledçŠ¶æ€çš„å›è°ƒã€‚</p>
<h2 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject()"></a>Promise.reject()</h2><p>Pomiseç±»æ–¹æ³•Promise.reject()å¾—åˆ°ä¸€ä¸ªrejected çš„promiseï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.reject(x)ï¼› <span class="comment">// xæ˜¯ä»»æ„å€¼ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™ä¸ºundefined</span></span><br></pre></td></tr></table></figure>
<p>Promise.reject(x)ä¸Promise.resolve(x)ä¸åŒï¼ŒPromise.reject(x)æ˜¯å°†xä½œä¸ºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ã€‚è¿™å°±æ„å‘³ç€ä»ç„¶ä¼šå¾—åˆ°ä¸€ä¸ªrejected promiseï¼Œå¹¶ä¸”å®ƒçš„å€¼æ—¶ä¸€ä¸ªï¼ˆç±»å‹ä¸ºPromiseï¼‰çš„å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="built_in">Promise</span>.resolve(<span class="string">'shuliqi'</span>);</span><br><span class="line"><span class="keyword">const</span> p2 =<span class="built_in">Promise</span>.reject(p1);</span><br><span class="line">p2.then().catch(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'typeof reason:'</span>, <span class="keyword">typeof</span> reason);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'instanceof Promise:'</span>, reason <span class="keyword">instanceof</span> <span class="built_in">Promise</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'reason === p1:'</span>, reason === p1)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// typeof reason: object</span></span><br><span class="line"><span class="comment">// instanceof Promise: true</span></span><br><span class="line"><span class="comment">// reason === p1: true</span></span><br></pre></td></tr></table></figure>
<h2 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a>Promise.all()</h2><p>å°è¯•resolveæ‰€æœ‰å…ƒç´ ã€‚å½“æ‰€æœ‰çš„å…ƒç´ éƒ½resolvedï¼Œå¾—åˆ°ä¸€ä¸ªå°†æ‰€æœ‰ç»“æœä½œä¸ºresolved arrayçš„promiseã€‚å½“ä»»æ„ä¸€ä¸ªå…ƒç´ rejectedï¼Œå¾—åˆ°ä¸€ä¸ªè¯¥ç»“æœ reason çš„rejected promiseã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.all(x); <span class="comment">// x å¿…é¡»æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼ˆé›†åˆå¯¹è±¡ï¼Œæˆ–è€…æ˜¯æœ‰è¿­ä»£å™¨çš„å¯¹è±¡ï¼‰</span></span><br></pre></td></tr></table></figure>
<p><strong>å¯è¿­ä»£çš„å¯¹è±¡</strong>ï¼šæ•°ç»„ï¼Œ Map/Seté›†åˆï¼Œå­—ç¬¦ä¸²å¯è¿­ä»£çš„å¯¹è±¡ï¼šæ•°ç»„ï¼Œ Map/Seté›†åˆï¼Œå­—ç¬¦ä¸² ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timeout1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(resolve, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(resolve, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.all([timeout1, timeout2])</span><br><span class="line">  .then(<span class="function">(<span class="params">[data1, data2]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"éƒ½æ‰§è¡Œå®Œæˆäº†"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æ²¡æœ‰catch"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// éƒ½æ‰§è¡Œå®Œæˆäº†</span></span><br></pre></td></tr></table></figure>
<p>Promise.all()ä¼šå¯¹æ‰€æœ‰çš„å…ƒç´ è¿›è¡Œé¢„å¤„ç†ï¼ˆPromise.resolve(x)ï¼‰æ‰€ä»¥æ— è®ºx æ˜¯ä¸€ä¸ªæ™®é€šå€¼è¿˜æ˜¯ä¸€ä¸ªâ€œæ½œåœ¨çš„promiseâ€ï¼Œ å®ƒéƒ½å°†ä½œä¸ºä¸€ä¸ªresolved promiseè¿›å…¥åç»­çš„å¤„ç†ï¼Œå³ä½¿xæ˜¯ä¸€ä¸ªrejected promiseï¼Œ é‚£ä¹ˆå®ƒçš„çŠ¶æ€(Promise.resolve(rejected_promise))ä¾ç„¶ä¼šå½±å“Promise.all()çš„æœ€ç»ˆçŠ¶æ€çš„åˆ¤æ–­ã€‚ ä¸€æ—¦å‘ç°rejectedï¼Œåˆ™è¿”å›rejectedçš„ç»“æœã€‚</p>
<p>promise.all(element)åªæœ‰elementå®Œå…¨resolvedæ—¶ï¼Œä¼šåœ¨then()ä¸­å¾—åˆ°ä¸€ä¸ªä¸åŸå§‹element å­˜åœ¨æ˜ å°„å…³ç³»çš„æ•°ç»„ã€‚</p>
<h2 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race()"></a>Promise.race()</h2><p>å°è¯•resolve æ‰€æœ‰å…ƒç´ ã€‚åªè¦å…¶ä»»ä¸€å…ƒç´ resolved æˆ– rejectedï¼Œéƒ½å°†ä»¥è¯¥ç»“æœä½œä¸ºç»“æœpromise</p>
<p>æ³¨æ„ï¼šæ‰€æœ‰çš„å…¶ä»–çš„å…ƒç´ çš„çŠ¶æ€éƒ½æ˜¯æœªç¡®å®šçš„ï¼Œå¹¶ä¸”ä»–ä»¬çš„æ‰§è¡Œè¿‡ç¨‹ä¸ç»“æœä¸ç¡®å®š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.race(x); <span class="comment">// x å¿…é¡»æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼ˆé›†åˆå¯¹è±¡ï¼Œæˆ–è€…æ˜¯æœ‰è¿­ä»£å™¨çš„å¯¹è±¡ï¼‰</span></span><br></pre></td></tr></table></figure>
<p>Promise.race()ä¸Promise.all()ç±»ä¼¼ï¼Œ éƒ½ä¼šå¯¹æ‰€æœ‰çš„å…ƒç´ è¿›è¡Œé¢„å¤„ç†ï¼ˆPromise.resolve(x)ï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"timeout 1"</span>);</span><br><span class="line">    resolve();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"timeout2"</span>);</span><br><span class="line">    reject();</span><br><span class="line">  &#125;, <span class="number">500</span>); <span class="comment">// å¼‚æ­¥æ“ä½œè®¾ç½®rejecteï¼Œ å¤±è´¥</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.race([timeout1, timeout2])</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"ç¬¬ä¸€ä¸ªtimeçŠ¶æ€å‘ç”Ÿæ”¹å˜äº†"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"catch"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// timeout2</span></span><br><span class="line"><span class="comment">//  catch</span></span><br><span class="line"><span class="comment">//  timeout 1</span></span><br></pre></td></tr></table></figure>
<h1 id="Promiseå¯¹è±¡çš„åŸå‹æ–¹æ³•"><a href="#Promiseå¯¹è±¡çš„åŸå‹æ–¹æ³•" class="headerlink" title="Promiseå¯¹è±¡çš„åŸå‹æ–¹æ³•"></a>Promiseå¯¹è±¡çš„åŸå‹æ–¹æ³•</h1><p>Promiseå¯¹è±¡æ–¹æ³•Promise.prototype.xxx(p.xxx)ä¸»è¦ç”¨äºå“åº”ä¸€ä¸ªpromise çŠ¶æ€ï¼Œå¹¶ä¸”å¯¹è±¡æ–¹æ³•çš„å“åº”ç»“æœä¹Ÿå¿…ç„¶æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„promise2ã€‚é™¤äº†.then()ä¹‹å¤–ï¼Œpromiseå¯¹è±¡æœ€ä¸»è¦çš„çš„åŸå‹æ–¹æ³•â€”.catch() å’Œ.finally()éƒ½æ˜¯é€šè¿‡é€šè¿‡.then()æ¥é—´æ¥å®ç°çš„ã€‚</p>
<h2 id="Promise-Prototype-catch"><a href="#Promise-Prototype-catch" class="headerlink" title="Promise.Prototype.catch()"></a>Promise.Prototype.catch()</h2><p>.catch(onRejected) ä¸.then(_, onRejected)ä¸­çš„å‚æ•°ä¸€è‡´ï¼Œ ä¸¤ç§ç”¨æ³•çš„æ•ˆæœä¹Ÿè¿‘ä¼¼ã€‚</p>
<p>ä½†æ˜¯ä½¿ç”¨.catch()çš„æ–¹æ³•ï¼Œ å°¤å…¶æ˜¯åœ¨Thené“¾æœ«ç«¯çš„.catch()æ˜¯éå¸¸å¿…è¦çš„å’Œå®‰å…¨çš„ï¼Œ å› ä¸º.then(onFulfilled, onRejected)ä¸­çš„onRejectedå‡½æ•°å¹¶ä¸èƒ½æ•è·åˆ°onFulfilledå‡½æ•°é‡Œé¢çš„å¼‚å¸¸(ä»¥åŠå…¶ä¸­è¿”å›çš„rejected promise)ã€‚ å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onFulfilled = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">'æˆ‘æŠ›å‡ºå¼‚å¸¸ï¼Œäº§ç”Ÿrejected promise'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> onRejected = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ²¡æœ‰èƒ½æ•è·onFulfilledå‡½æ•°è¿”å›çš„rejected promise'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve();</span><br><span class="line">p.then(onFulfilled, onRejected)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­çš„onRejected å‡½æ•°å¹¶ä¸èƒ½å“åº”onFulfilledå‡½æ•°ä¸­æŠ›å‡ºçš„å¼‚å¸¸ä»¥åŠJavaScriptä¸ºè¯¥å¼‚å¸¸è€Œåˆ›å»ºçš„rejected promiseï¼Œå°†ä¼šé—æ¼å¯¹rejected Promiseçš„å¤„ç†ï¼Œäº‰å–çš„å¤„ç†åº”è¯¥æ˜¯éµå¾ªâ€œå§‹äºpromiseï¼Œç»ˆäºcatchâ€çš„åŸåˆ™ã€‚å¦‚ä¸‹ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onFulfilled = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">'æˆ‘æŠ›å‡ºå¼‚å¸¸ï¼Œäº§ç”Ÿrejected promise'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> onRejected = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æ²¡æœ‰èƒ½æ•è·onFulfilledå‡½æ•°è¿”å›çš„rejected promise'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve();</span><br><span class="line">p.then(onFulfilled, onRejected).catch(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘æ¥å¤„ç†onFulfilledäº§ç”Ÿçš„å¼‚å¸¸:'</span>, reason)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// æˆ‘æ¥å¤„ç†onFulfilledäº§ç”Ÿçš„å¼‚å¸¸ï¼š æˆ‘æŠ›å‡ºå¼‚å¸¸ï¼Œäº§ç”Ÿrejected promise</span></span><br></pre></td></tr></table></figure>
<h2 id="Promise-Prototype-finally"><a href="#Promise-Prototype-finally" class="headerlink" title="Promise.Prototype.finally()"></a>Promise.Prototype.finally()</h2><p>finally()æ–¹æ³•ï¼Œä¸tryâ€¦catch/finallyä¸­çš„finallyå­å¥çš„è¯­æ³•ç±»ä¼¼ï¼›ä½¿ä»£ç æ— è®º.catch()è¿˜æ˜¯.then()è°ƒç”¨ç»“æŸåï¼Œæ€»æ˜¯èƒ½å¾—åˆ°ä¸€æ¬¡è°ƒç”¨.fanally()çš„æœºä¼šã€‚</p>
<p><strong>è¯¥æ–¹æ³•ä¸æ¥å—ä»»ä½•çš„å‚æ•°ï¼Œæ„æ€å°±æ˜¯æœ€åçš„Promiseä»£ç†çš„å€¼æ˜¯ä»€ä¹ˆï¼Œ æ˜¯æ²¡æœ‰åŠæ³•çŸ¥é“çš„ã€‚finally()æ–¹æ³•è·Ÿæœ€åçš„promiseçš„çŠ¶æ€æ˜¯æ— å…³çš„ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// finallyï¼ˆï¼‰æ–¹æ³•çš„å“åº”å‡½æ•°æ˜¯æ— ä¼ å…¥å‚æ•°çš„</span></span><br><span class="line"><span class="keyword">const</span> onFinally = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"ä¸ç®¡promiseçŠ¶æ€æ€ä¹ˆæ ·ï¼Œ æˆ‘éƒ½ä¼šæ‰§è¡Œ, å¹¶ä¸”æˆ‘æ˜¯æ— å‚æ•°å‚å…¥çš„å“¦"</span>, value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"æˆ‘æŠ›å‡ºé”™è¯¯"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">p</span><br><span class="line">.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"æˆåŠŸ"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"å‘ç”Ÿé”™è¯¯"</span>, error);</span><br><span class="line">&#125;)</span><br><span class="line">.finally(onFinally);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¾‹å­çš„ç»“æœä¸ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‘ç”Ÿé”™è¯¯ <span class="built_in">Error</span>: æˆ‘æŠ›å‡ºé”™è¯¯</span><br><span class="line">    at &lt;anonymous&gt;:<span class="number">6</span>:<span class="number">15</span></span><br><span class="line">    at <span class="keyword">new</span> <span class="built_in">Promise</span> (<span class="xml"><span class="tag">&lt;<span class="name">anonymous</span>&gt;</span>)</span></span><br><span class="line">    at &lt;anonymous&gt;:5:15</span><br><span class="line">VM134:3 ä¸ç®¡promiseçŠ¶æ€æ€ä¹ˆæ ·ï¼Œ æˆ‘éƒ½ä¼šæ‰§è¡Œ, å¹¶ä¸”æˆ‘æ˜¯æ— å‚æ•°å‚å…¥çš„å“¦ undefined</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­çš„onFinallyå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ‰“å°value å€¼ï¼Œå€¼ä¸ºundefinedã€‚è¯´æ˜.finally()çš„onFinallyå‡½æ•°æ˜¯ä¸æ¥å—ä»»ä½•å‚æ•°çš„ã€‚</p>
<p><strong>é»˜è®¤.finally()æ–¹æ³•ä¸ä¼šæ”¹å˜Then é“¾ä¸Šå‰ç«¯æ‰€äº§ç”Ÿçš„å€¼ï¼Œä¹ŸåŒ…æ‹¬å…¶çŠ¶æ€ã€‚</strong></p>
<p>JavaScript ä¸å¤„ç†åœ¨å“åº”å‡½æ•°onFinallyä¸­çš„ä»»ä½•è¿”å›å€¼ï¼Œ.finally()æ–¹æ³•çš„ç»“æœâ€”åªæ˜¯ç®€å•çš„â€œå¾—åˆ°äº†â€é“¾ä¸Šçš„å‰ä¸€ä¸ªpromiseå¯¹è±¡æ‰€ä»£ç†çš„æ•°æ®ã€‚å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="string">"æˆ‘æ˜¯èˆ’åŠ›æ°”"</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="built_in">Promise</span>.resolve(x);</span><br><span class="line"><span class="keyword">const</span> p2 = p1.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'æˆ‘çš„å¹´é¾„æ˜¯21'</span></span><br><span class="line">&#125;);</span><br><span class="line">p2.then(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘çš„å€¼æ˜¯ï¼š'</span>, value)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// æˆ‘çš„å€¼æ˜¯ï¼šæˆ‘æ˜¯èˆ’åŠ›æ°”</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä¾‹å­ä¸­.finally()çš„onFinallyä¸­çš„è¿”å›å€¼è‡ªåŠ¨è¢«å¿½ç•¥ã€‚æ‰€ä»¥p2çš„å€¼æ˜¯å‰ä¸€ä¸ªpromiseå¯¹è±¡æ‰€ä»£ç†çš„å€¼ï¼ˆp1çš„å€¼ï¼‰ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿæœ‰ä¾‹å¤–çš„æ—¶å€™ã€‚å¦‚æœ.finally()çš„å“åº”å‡½æ•°onFinally()ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæˆ–è€…ç”¨æˆ·ä»£ç æ˜¾å¼çš„è¿”å›äº†rejected promiseã€‚ é‚£ä¹ˆå°±ä¼šæ›¿ä»£äº†thené“¾ä¸Šä¹‹å‰çš„promiseå¯¹è±¡æ‰€ä»£ç†çš„å€¼äº†ã€‚å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="string">"æˆ‘æ˜¯èˆ’åŠ›æ°”"</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="built_in">Promise</span>.resolve(x);</span><br><span class="line"><span class="keyword">const</span> p2 = p1.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">'æˆ‘åœ¨onFinallyå‡½æ•°ä¸­æ˜¾å¼çš„è¿”å›äº†rejected promiseäº†'</span>)</span><br><span class="line">&#125;);</span><br><span class="line">p2.catch(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆ‘çš„å€¼æ˜¯ï¼š'</span>, reason)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// æˆ‘çš„å€¼æ˜¯ï¼š æˆ‘åœ¨onFinallyå‡½æ•°ä¸­æ˜¾å¼çš„è¿”å›äº†rejected promiseäº†</span></span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">èˆ’å°ç¦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://shuliqi.github.io/2020/07/15/ã€ŠJavaScriptè¯­è¨€ç²¾é«“ä¸ç¼–ç¨‹å®æˆ˜ã€‹è¯»ä¹¦ç¬”è®°-Promisedçš„æ ¸å¿ƒæœºåˆ¶/">https://shuliqi.github.io/2020/07/15/ã€ŠJavaScriptè¯­è¨€ç²¾é«“ä¸ç¼–ç¨‹å®æˆ˜ã€‹è¯»ä¹¦ç¬”è®°-Promisedçš„æ ¸å¿ƒæœºåˆ¶/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://shuliqi.github.io">èˆ’å°ç¦çš„Blog</a>ï¼</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/shuliqi.github.io/2020/08/31/å°è£…axioså–æ¶ˆé‡å¤è¯·æ±‚/"><i class="fa fa-chevron-left">  </i><span>æ‰‹æŠŠæ‰‹å°è£…axioså–æ¶ˆé‡å¤è¯·æ±‚</span></a></div><div class="next-post pull-right"><a href="/shuliqi.github.io/2020/06/22/æ–‡æœ¬è¶…å‡ºæ˜¾ç¤ºçœç•¥å·çš„ä¸€ä¸ªå®Œç¾çš„æ–¹æ¡ˆ/"><span>æ–‡æœ¬è¶…å‡ºæ˜¾ç¤ºçœç•¥å·çš„ä¸€ä¸ªå®Œç¾çš„æ–¹æ¡ˆ</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By èˆ’å°ç¦</div><div class="framework-info"><span>é©±åŠ¨ - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/shuliqi.github.io/js/utils.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/fancybox.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/sidebar.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/copy.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/fireworks.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/transition.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/scroll.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/head.js?version=1.6.1"></script><script src="/shuliqi.github.io/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« "></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>