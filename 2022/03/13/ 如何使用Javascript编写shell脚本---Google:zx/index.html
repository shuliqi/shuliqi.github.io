<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="如何使用 Javascript 编写 shell 脚本---Google/zx"><meta name="keywords" content=""><meta name="author" content="舒小琦"><meta name="copyright" content="舒小琦"><title>如何使用 Javascript 编写 shell 脚本---Google/zx | 舒小琦的Blog</title><link rel="shortcut icon" href="http://p6.qhimg.com/t01f5a5270b7946b505.jpg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">问题背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">内置函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#command"><span class="toc-number">4.1.</span> <span class="toc-text">$&#96;command&#96;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ProcessPromise"><span class="toc-number">4.1.1.</span> <span class="toc-text">ProcessPromise</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProcessOutput"><span class="toc-number">4.1.2.</span> <span class="toc-text">ProcessOutput</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cd"><span class="toc-number">4.2.</span> <span class="toc-text">cd()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fetch"><span class="toc-number">4.3.</span> <span class="toc-text">fetch()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#question"><span class="toc-number">4.4.</span> <span class="toc-text">question()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sleep"><span class="toc-number">4.5.</span> <span class="toc-text">sleep()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nothrow"><span class="toc-number">4.6.</span> <span class="toc-text">nothrow()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%9A%84%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">5.</span> <span class="toc-text">内置的全局变量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#chalk"><span class="toc-number">5.1.</span> <span class="toc-text">chalk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fs"><span class="toc-number">5.2.</span> <span class="toc-text">fs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#globby"><span class="toc-number">5.3.</span> <span class="toc-text">globby</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#os"><span class="toc-number">5.4.</span> <span class="toc-text">os</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#path"><span class="toc-number">5.5.</span> <span class="toc-text">path</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#minimist"><span class="toc-number">5.6.</span> <span class="toc-text">minimist</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://p6.qhimg.com/t01f5a5270b7946b505.jpg"></div><div class="author-info__name text-center">舒小琦</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">59</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">13</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">13</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/webp.webp)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">舒小琦的Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/shuliqi-design">组件</a><a class="site-page" href="/about">关于</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">如何使用 Javascript 编写 shell 脚本---Google/zx</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-03-13</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p><a target="_blank" rel="noopener" href="https://github.com/google/zx">Google-zx</a>  是谷歌推出的一个开源的项目， 一个可以使用前端熟悉的<code>JavaScript</code>语法来编写 <code>shell</code> 的工具。如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> $<span class="string">`cat package.json | grep name`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> branch = <span class="keyword">await</span> $<span class="string">`git branch --show-current`</span></span><br><span class="line"><span class="keyword">await</span> $<span class="string">`dep deploy --branch=<span class="subst">$&#123;branch&#125;</span>`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">  $<span class="string">`sleep 1; echo 1`</span>,</span><br><span class="line">  $<span class="string">`sleep 2; echo 2`</span>,</span><br><span class="line">  $<span class="string">`sleep 3; echo 3`</span>,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;foo bar&#x27;</span></span><br><span class="line"><span class="keyword">await</span> $<span class="string">`mkdir /tmp/<span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面代码中可以看出在<code> JavaScript</code> 中 插入了 <code>shell</code>。那么这种写法行不行呢？ 答案是可以的，如果我们使用了<a target="_blank" rel="noopener" href="https://github.com/google/zx">Google-zx</a>  的话。</p>
 <span id="more"></span>

<h1 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h1><p>创建 <code>shell</code> 脚本的主要目的是 <code>shell</code> 脚本能够帮忙我们自动化实现一些重复的任务的。在编写脚本的时候通常会选择一些更加方便的编程预言。 对于前端开发工程师来说 <code>Node.js</code> 无疑是最好的选择了，它提供了很多核心的模块，并且还可以导入前端其他的脚本库。可以降低很多的学习成本。</p>
<p>但是我们尝试编写一个在<code>Node.js</code>下运行的 <code>shell</code> 脚本，发现并不是很流畅。 需要为子进程编写特殊处理；注意转义命令行参数；然后使用使用标准输出   <code>stdout</code> 和错误 <code>stderr</code>  ，显得不是很直观； 并且在使用之前需要做很多额外的操作，如：引入库等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 execSync 命令 from child_process 模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; execSync &#125; = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步创建了一个 shuliqi 的文件夹</span></span><br><span class="line">execSync(<span class="string">&quot;mkdir shuliqi&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 exec 命令 from child_process 模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步发布一个 npm 包</span></span><br><span class="line">exec(<span class="string">&#x27;npm publish&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;发布失败:&quot;</span>, err);</span><br><span class="line">    process.exit(<span class="number">1</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;发布成功&quot;</span>, data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>Bash shell</code> 脚本语言试试编写<code>shell</code>脚本的最佳选择，不需要编写代码来处理子进程，并且它有用于处理</p>
<p><code>stdout</code> 和 <code>stderr</code> 的内置语言特性。 但是<code>Bash</code> 编写 <code>shell</code> 脚本也不是那么容易。语法比较混乱，使得实现逻辑或处理用户提示是输入之类的事情变得不是那么方便。</p>
<p>那么<code>Google</code>的<code>zx.js</code>库就很有助于使用<code>Node.js</code>高效快速的编写<code>shell</code>脚本。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>可根据如下命令进行全局安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i -g zx</span><br><span class="line"><span class="comment">#  or</span></span><br><span class="line">yarn add -g zx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>不一定非得全局安装， 可以局部安装的。下面的例子，都是使用的全局安装</p>
</blockquote>
<p>目前需要的环境</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Node.js &gt;= <span class="number">16.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>具体的<code>Node</code> 环境最新可到 <a target="_blank" rel="noopener" href="https://github.com/google/zx#-zx">Google/zx</a>查看。</p>
</blockquote>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>安装好 <code>zx</code> 之后，有两种方式可以编写脚本：</p>
<ol>
<li>将 <code>shell</code> 脚本编写在后缀名为 <code>.mjs</code>  的文件中， 不需要额外的封装了</li>
<li>将 <code>shell</code> 脚本编写在后缀名为 <code>.js</code>  的文件中，这种方式需要使用如下方式对脚本进行封装</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//  shell 脚本内容</span></span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>



<p>其次需要在文件头添加如下脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env zx</span></span><br></pre></td></tr></table></figure>



<p>运行的时候如果是全局安装的情况下直接在命令行使用<code>zx &lt;文件&gt;</code>即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ zx ./src/index.mjs</span><br></pre></td></tr></table></figure>



<p>举个例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env zx</span></span><br><span class="line"></span><br><span class="line">const fileName = <span class="string">&quot;zx-test&quot;</span></span><br><span class="line">await $`mkdir <span class="variable">$&#123;fileName&#125;</span>`;</span><br></pre></td></tr></table></figure>

<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/1.png" class="">





<h1 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h1><h2 id="command"><a href="#command" class="headerlink" title="$`command`"></a>$`command`</h2><p>该命令主要是使用了 <code>child_process</code> 的 <code>spawn</code> ( <a target="_blank" rel="noopener" href="http://nodejs.cn/api/child_process.html#child_processspawncommand-args-options">child_process.spawn</a> ) 函数来执行指定的字符串，并返回一个<code>ProcessPromise</code>。如果执行的程序返回非零退出代码。 将抛出<code>ProcessOutput</code>。</p>
<p>举个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命令</span></span><br><span class="line"><span class="keyword">const</span> commandPromise = $<span class="string">`ls -1 | wc -l`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步执行命令</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> commandPromise;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="built_in">parseInt</span>(result)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`文件的个数: <span class="subst">$&#123;count&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>



<h3 id="ProcessPromise"><a href="#ProcessPromise" class="headerlink" title="ProcessPromise"></a>ProcessPromise</h3><p>返回的 <code>ProcessPromise</code> 的 <code>typescript</code> 接口定义为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessPromise</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Promise</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  readonly stdin: Writable</span><br><span class="line">  readonly stdout: Readable</span><br><span class="line">  readonly stderr: Readable</span><br><span class="line">  readonly exitCode: <span class="built_in">Promise</span>&lt;number&gt;</span><br><span class="line">  pipe(dest): ProcessPromise&lt;T&gt;</span><br><span class="line">  kill(signal = <span class="string">&#x27;SIGTERM&#x27;</span>): <span class="built_in">Promise</span>&lt;<span class="keyword">void</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>pipe()</code>方法可用于重定向标准输出：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> $<span class="string">`echo &quot;你好世界&quot;`</span></span><br><span class="line">  .pipe(fs.createWriteStream(<span class="string">&#x27;file.txt&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> $<span class="string">`cat file.txt`</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/2.gif" class="">

<p>关于更多的<a target="_blank" rel="noopener" href="https://github.com/google/zx/blob/main/docs/pipelines.md">管道例子</a></p>
<h3 id="ProcessOutput"><a href="#ProcessOutput" class="headerlink" title="ProcessOutput"></a>ProcessOutput</h3><p>如果执行的程序返回非零退出代码，<code>ProcessOutput</code> 将被抛出。<code>ProcessPromise</code>的<code>typescript</code>定义为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessPromise</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Promise</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  readonly stdin: Writable</span><br><span class="line">  readonly stdout: Readable</span><br><span class="line">  readonly stderr: Readable</span><br><span class="line">  readonly exitCode: <span class="built_in">Promise</span>&lt;number&gt;</span><br><span class="line">  pipe(dest): ProcessPromise&lt;T&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>举个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 执行的程序返回非零退出码</span></span><br><span class="line">  <span class="keyword">await</span> $<span class="string">`exit 2`</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="comment">// ProcessOutput 被抛出</span></span><br><span class="line">  <span class="built_in">console</span>.log(error.exitCode); <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/3.gif" class="">

<h2 id="cd"><a href="#cd" class="headerlink" title="cd()"></a>cd()</h2><p><code>cd（）</code> 可用于更改当前工作目录：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更改当前的工作目录为： src 目录</span></span><br><span class="line">cd(<span class="string">&quot;./src&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出目前所在的工作目录的绝对路径名称</span></span><br><span class="line"><span class="keyword">await</span> $<span class="string">`pwd`</span>;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/4.gif" class="">

<h2 id="fetch"><a href="#fetch" class="headerlink" title="fetch()"></a>fetch()</h2><p>相当于<code> node</code> 的  <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/node-fetch">node-fetch</a> 包。 用于网络请求。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> resp = <span class="keyword">await</span> fetch(<span class="string">&#x27;https://www.fastmock.site/mock/31e59cb8bdba6b63482fd4e6914b76f2/borrow/getName&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> (resp.ok) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">await</span> resp.text()); <span class="comment">// &#123;&quot;data&quot;:&quot;你好世界&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/5.gif" class="">

<h2 id="question"><a href="#question" class="headerlink" title="question()"></a>question()</h2><p>是对 <code>Node Js</code> 的  <a target="_blank" rel="noopener" href="https://nodejs.org/api/readline.html">readline</a>  包的包装。它的作用是可以提示用户输入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="keyword">await</span> question(<span class="string">&#x27;请输入你的名字: &#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;你的名字是：&quot;</span>, name);</span><br></pre></td></tr></table></figure>

<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/6.gif" class="">

<blockquote>
<p>说是  question 函数的第二个参数是选项。但是没有试出来， 还没找到原因。</p>
</blockquote>
<h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h2><p>使用 setTimeout 实现的一个等待函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="keyword">await</span> question(<span class="string">&#x27;请输入你的名字: &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待 2000 毫秒之后 才会输出结果</span></span><br><span class="line"><span class="keyword">await</span> sleep(<span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;2000 毫秒之后输出，你的名字&quot;</span>, name);</span><br></pre></td></tr></table></figure>



<h2 id="nothrow"><a href="#nothrow" class="headerlink" title="nothrow()"></a>nothrow()</h2><p>捕捉 <code>$</code> 执行命令时遇到的非 0 返回值，使其不抛异常。一般来说，<code>Shell</code> 编程中<code>Exit Code</code>不为0代表有异常</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 执行的程序返回非零退出码</span></span><br><span class="line">  <span class="keyword">await</span> nothrow( $<span class="string">`exit 2`</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="comment">// 但是错误没有被抛出</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;该log不会打印，因为error没有被抛出&quot;</span>, error.exitCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>举个例子：</p>
<p>该例子中，开始没有使用 <code>nothrow</code> 函数，执行命令行遇到非0返回值是会抛出错误的。 之后使用 <code>nothrow</code> 函数， 执行，执行命令行遇到非0返回值则不会抛出错误。</p>
<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/7.gif" class="">



<h1 id="内置的全局变量"><a href="#内置的全局变量" class="headerlink" title="内置的全局变量"></a>内置的全局变量</h1><h2 id="chalk"><a href="#chalk" class="headerlink" title="chalk"></a>chalk</h2><p> 即 <code>chalk</code> 包，用于输出彩色的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(chalk.green(<span class="string">&#x27;绿色&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(chalk.red(<span class="string">&#x27;红色&#x27;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(chalk.yellow(<span class="string">&quot;黄色&quot;</span>));</span><br></pre></td></tr></table></figure>

<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/8.png" class="">

<p>更多的使用可看: <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/chalk">chalk</a></p>
<h2 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h2><p> 引用的 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/fs-extra">fs-extra</a>  包，用于完成常见的文件操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.copy(<span class="string">&#x27;./copy.txt&#x27;</span>, <span class="string">&#x27;copy1.txt&#x27;</span>)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;复制成功!&#x27;</span>))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">`复制失败：<span class="subst">$&#123;err&#125;</span>`</span>))</span><br></pre></td></tr></table></figure>

<p>结果:</p>
<img src="/2022/03/13/%20%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Javascript%E7%BC%96%E5%86%99shell%E8%84%9A%E6%9C%AC---Google:zx/9.gif" class="">

<p>例子中复制了名为 <code>copy.txt</code> 文件， 复制后的文件名为：<code>copy1.txt</code>。</p>
<h2 id="globby"><a href="#globby" class="headerlink" title="globby"></a>globby</h2><p>引用的 <a target="_blank" rel="noopener" href="https://github.com/sindresorhus/globby">globby</a> 包，用于模糊搜索文件名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> paths = <span class="keyword">await</span> globby([<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;!cake&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(paths);</span><br></pre></td></tr></table></figure>

<h2 id="os"><a href="#os" class="headerlink" title="os"></a>os</h2><p>引用的 <a target="_blank" rel="noopener" href="https://nodejs.org/api/os.html">os</a> 包，用于获取系统信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> type = os.type();</span><br><span class="line"><span class="keyword">const</span> arch = os.arch();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`你的系统是<span class="subst">$&#123;type&#125;</span>, <span class="subst">$&#123;arch&#125;</span>位`</span>)</span><br></pre></td></tr></table></figure>



<h2 id="path"><a href="#path" class="headerlink" title="path"></a>path</h2><p>引用的 <a target="_blank" rel="noopener" href="https://nodejs.org/api/path.html">path</a> 包，用于对路径做处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> file = path.basename(<span class="string">&quot;/foo/bar/baz/asdf/shuliqi.txt&quot;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(file); <span class="comment">// shuliqi.txt</span></span><br></pre></td></tr></table></figure>



<h2 id="minimist"><a href="#minimist" class="headerlink" title="minimist"></a>minimist</h2><p>引用的 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/minimist">minimist</a> 包，用于处理命令行参数。</p>
<p>关于更多可直接访问 <a target="_blank" rel="noopener" href="https://github.com/google/zx">Github</a> 或 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/zx">NPM</a> 查看 。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">舒小琦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://shuliqi.github.io/2022/03/13/ 如何使用Javascript编写shell脚本---Google:zx/">https://shuliqi.github.io/2022/03/13/ 如何使用Javascript编写shell脚本---Google:zx/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shuliqi.github.io">舒小琦的Blog</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/07/11/React-18-%E6%96%B0%E7%89%B9%E6%80%A7/"><i class="fa fa-chevron-left">  </i><span>React 18 的一些新特性</span></a></div><div class="next-post pull-right"><a href="/2022/02/23/npm%20scripts%20%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F/"><span>你真的了解 npm 脚本吗？</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/webp.webp)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By 舒小琦</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>