---
title: Javascriptæ¨¡å—åŒ–ç¼–ç¨‹æ€»ç»“
date: 2021-03-06 10:36:32
tags:
---



åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  [æ¨¡å—åŒ–ä¸Webpackå±æ€§ library,libraryTargetçš„å…³è”](https://shuliqi.github.io/shuliqi.github.io/2021/02/03/webpack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9Alibrary%EF%BC%8ClibraryTarget%EF%BC%8CauxiliaryComment/)ä¸­æåˆ°å¾ˆå¤šå…³äºæ¨¡å—åŒ–çš„è§„èŒƒã€‚ å¦‚ä»€ä¹ˆæœ‰äº›æ¨¡å—éœ€è¦æš´éœ²åœ¨`module.export`ä¸Šï¼Œè€Œæœ‰äº›éœ€è¦è¦æš´éœ²ä¸º`define('XXX', [], function() =>{})`ç­‰ç­‰ã€‚è¿™äº›éƒ½æ˜¯å› ä¸ºä½¿ç”¨ä¸åŒçš„è§„èŒƒå¯¼è‡´çš„ã€‚å¯èƒ½ä¼šæœ‰ç‚¹æ··ä¹±ï¼Œè¿™é‡Œå°±å¥½å¥½æ¥æ€»ç»“æ¨¡å—åŒ–çš„åˆ°åº•æœ‰å“ªäº›è§„èŒƒã€‚

ç›®å‰çš„æ¨¡å—åŒ–çš„è§„èŒƒï¼š**`CommonJs`**ï¼Œ**`AMD`**ï¼Œ**`CMD`** å’Œ **`ES6æ¨¡å—`**ã€‚

<!--more -->

é¦–å…ˆå…ˆæ¥çœ‹ä¸€å¼ å›¾ç‰‡ï¼Œè¯´æ˜è¿™ç§æ¨¡å¼çš„æ•´ä½“åŒºåˆ«ï¼š

{% asset_img 2.png %}

é‚£ä¹ˆæ¥ä¸‹æ¥å…·ä½“è®²è®²ï¼

# CommonJS

`CommonJS`æ˜¯ä»¥åœ¨æµè§ˆå™¨ä¹‹å¤–æ„å»º `Javascript `ç”Ÿæ€ç³»ç»Ÿä¸ºç›®æ ‡è€Œäº§ç”Ÿçš„é¡¹ç›®ï¼Œæ¯”å¦‚åœ¨æœåŠ¡å™¨é‡Œé¢ã€‚`CommonJS`çš„ä»£è¡¨ï¼šNodeåº”ç”¨ä¸­çš„æ¨¡å—ï¼Œé€šä¿—çš„æ¥è¯´å°±æ˜¯` npm` å®‰è£…çš„æ¨¡å—ã€‚

## åŸºæœ¬æ¦‚å¿µ

`Node` åº”ç”¨æ˜¯ç”±æ¨¡å—ç»„æˆï¼Œ`Node`çš„æ¨¡å—é‡‡ç”¨`CommonJS`æ¨¡å—è§„èŒƒï¼›é‚£ä¹ˆå®ƒçš„è§„èŒƒæœ‰å“ªäº›å‘¢ï¼Ÿ

`CommonJS`æ¨¡å—è§„èŒƒï¼š

- æ¯ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œéƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶å®šä¹‰çš„å˜é‡ï¼Œå‡½æ•°ï¼Œç±»éƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–çš„æ–‡ä»¶ä¸å¯è§ã€‚

  ```javascript
  // test.js
  var name = "shuliqi";
  var getName =  function() {
    return name;
  }
  ```

  ä¸Šé¢è¿™ä¸ªä»£ç è¡¨ç¤ºï¼šå˜é‡ `x` å’Œå‡½æ•° `getName` æ˜¯å½“å‰ `test.js`ç§æœ‰çš„ï¼Œå…¶ä»–æ–‡ä»¶æ˜¯ä¸å¯è§çš„ã€‚å¦‚æœæƒ³åœ¨å¤šä¸ªæ–‡ä»¶ä¸­åˆ†äº«ä¸€ä¸ªå˜é‡çš„è¯ï¼Œ å¿…é¡»å®šä¹‰ä¸º `global`å¯¹è±¡çš„å±æ€§ï¼›å½“ç„¶ï¼Œè¿™ç§å†™æ³•æ˜¯ä¸æ¨èçš„ã€‚

- æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œ`module` å˜é‡ä»£è¡¨å½“å‰çš„æ¨¡å—ã€‚è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ `exports `å±æ€§(`module.exports`)æ˜¯å¯¹å¯¹å¤–çš„æ¥å£

  ```javascript
  // test.js
  var name = "shuliqi";
  var getName =  function() {
    return name;
  }
  module.exports.name = name;
  module.exports.getName = getName;
  ```

  ä¸Šé¢çš„ä»£ç é€šè¿‡`module.exports`å°†å˜é‡`name`,`getName`æš´éœ²å‡ºæ¥ã€‚

- `Node`çš„æ¯ä¸ªæ¨¡å—æä¾›ä¸€ä¸ª `exports` å˜é‡ï¼Œ æŒ‡å‘ `module.exports`ï¼›è¿™ç­‰åŒäºåœ¨æ¯ä¸ªæ¨¡å—å¤´éƒ¨ï¼Œ éƒ½æœ‰è¿™æ ·çš„ä»£ç ã€‚

  ```javascript
  var exports= module.exports;
  ```

  è¿™ä¸ªé€ æˆçš„ç»“æœæ˜¯ï¼šåœ¨å¯¹å¤–è¾“å‡ºæ¨¡å—æ¥å£æ—¶ï¼Œå¯ä»¥å‘ `exports`å¯¹è±¡æ·»åŠ æ–¹æ³•

  > æ³¨æ„ï¼Œä¸èƒ½ç›´æ¥å°†exportså˜é‡æŒ‡å‘ä¸€ä¸ªå€¼ï¼Œå› ä¸ºè¿™æ ·ç­‰äºåˆ‡æ–­äº†`exports`ä¸`module.exports`çš„è”ç³»ã€‚

  > æ³¨æ„ï¼šä¸èƒ½ç›´æ¥å°†`exports`å˜é‡æŒ‡å‘ä¸€ä¸ªå€¼, å› ä¸ºè¿™æ ·å°±ç­‰ç”¨äºåˆ‡æ–­äº† `exports` å’Œ`module.exports`ä¹‹é—´çš„è”ç³»ï¼›å¦‚æœ ä¸€ä¸ªæ¨¡å—çš„å¯¹å¤–æ¥å£æ˜¯ä¸€ä¸ªä¸€ä¸ªå•ä¸€çš„å€¼ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ä¸èƒ½ç”¨ `exports` çš„ã€å»ºè®®è¿˜æ˜¯ç›´æ¥ä½¿ç”¨ `module.exports`ã€‚ä¸ç”¨åŒºåˆ†é‚£ä¹ˆå¤š

- **åœ¨æœåŠ¡ç«¯ï¼Œæ¨¡å—çš„åŠ è½½æ˜¯è¿è¡Œæ—¶åŒæ­¥åŠ è½½çš„ï¼›åœ¨æµè§ˆå™¨ç«¯ï¼Œæ¨¡å—éœ€è¦æå‰ç¼–è¯‘æ‰“åŒ…å¤„ç†ï¼ˆè¿™ä¸ªæˆ‘ä»¬ä¸‹é¢çš„ä¾‹å­ä¼šå…·ä½“æ¥è®²ï¼‰**



CommonJSæ¨¡èŒƒå®šä¹‰åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

* æ¨¡å—å®šä¹‰

  æ¨¡å—å®šä¹‰å…¶å®å°±æ˜¯æš´éœ²æ¨¡å—ï¼Œå¯ä»¥æŠŠæ¨¡å—æš´éœ²åœ¨`module.exports`æˆ–è€…`exports`ä¸Š

  ```javascript
  module.exports.name = "shuliqi";
  exports.getName = function() {
  	return ...
  }
  ```

  æŠŠå¯¹å¤–å¼€æ”¾çš„æ¥å£éƒ½æš´éœ²åœ¨ `module.exports`å¯¹è±¡ä¸Šã€‚

* æ¨¡å—æ ‡è¯†

  æ¨¡å—æ ‡è¯†å°±æ˜¯`require()`å‡½æ•°çš„å‚æ•°ï¼Œè§„èŒƒæ˜¯è¿™æ ·çš„

  - å¿…é¡»æ˜¯å­—ç¬¦ä¸²

  - å¯ä»¥æ˜¯ä»¥./, ../å¼€å¤´çš„ç›¸å¯¹è·¯å¾„

  - å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„

  - å¯ä»¥çœç•¥åç¼€å

  `require`å‘½ä»¤ç”¨äºåŠ è½½æ¨¡å—æ–‡ä»¶ï¼Œè¯»å…¥å¹¶ä¸”æ‰§è¡Œä¸€ä¸ª`Javascript` æ–‡ä»¶ï¼Œç„¶åè¿”å›è¯¥æ¨¡å—çš„çš„ `exports` çš„å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ¨¡å—ï¼Œ ä¼šæŠ¥é”™ã€‚

* å¼•ç”¨æ¨¡å—

  ä½¿ç”¨ `require` åŠ è½½æ¨¡å—
  
  ```javascript
  // ç»å¯¹è·¯å¾„
  const name =  require('shuliqi/study/name.js');
  
  // çœç•¥äº†åç¼€åï¼Œ ç›¸å¯¹è·¯å¾„
  const getName = require('./getName');
  
  // æ¨¡å—å¼ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œç›´æ¥å¼•ç”¨æ¨¡å—å
const http = require('http');
  ```
  
  

## æœåŠ¡ç«¯ä½¿ç”¨

 é¦–å…ˆè‚¯å®šå¾—ä¸‹è½½[NodeJS](https://nodejs.org/en/)ã€‚åˆ°è¿™ä¸ªé¡µé¢è¿›è¡Œä¸‹è½½å“¦ã€‚

### é¡¹ç›®ç»“æ„

ç„¶ååˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„:

```
$ mkdir module-example
$ cd module-example
$ npm init
```

æ·»åŠ ä¸€äº›æ–‡ä»¶å¤¹ä»¥åŠæ–‡ä»¶ï¼›æœ€åçš„åŸºæœ¬ç»“æ„ä¸ºï¼š

```
|--src
  |--CommonJS
    |--module1.js
    |--module2.js
    |--index.js
|--package.json
```

### å®šä¹‰æ¨¡å—

module1.js

```javascript
// æš´éœ²ï¼ˆå®šä¹‰ï¼‰æ¨¡å—ï¼šå¯ä»¥ç›´æ¥åœ¨å†™ module.exports å¯¹è±¡ä¸Š
module.exports = {
  name: "æ¨¡å—1",
  getName: function() {
    console.log(this.name)
  }
}
```

module2.js

```javascript
//  æš´éœ²ï¼ˆå®šä¹‰ï¼‰æ¨¡å—ï¼šä¹Ÿå¯ä»¥ç›´æ¥åœ¨å†™ exports å¯¹è±¡ä¸Š
exports.getName = () => {
  console.log("shuliqi")
}
```

### åŠ è½½æ¨¡å—

index.js

```javascript
 // å¼•ç”¨æ¨¡å—ï¼š é€šè¿‡æ¨¡å—è¡¨ç¤º require æ¥å¼•ç”¨ï¼›
 // æ¨¡å—æ ‡è¯† å¯ä»¥çœç•¥åç¼€åï¼Œ å¯ä»¥ä½¿ç›¸å¯¹åœ°å€
const module1 = require('./module1');
console.log(module1.name);
module1.getName(); 

const module2 = require('./module2.js')
module2.getName();

```

### æ‰§è¡Œæ¨¡å—

æœ€åæˆ‘ä»¬æ‰§è¡Œ `index.js` æ–‡ä»¶

```javascript
// æ ¹ç›®å½•æ‰§è¡Œ
$ node src/commonJS/index.js 
```

### æ‰§è¡Œç»“æœ

```
 æ¨¡å—1
 æ¨¡å—1
 shuliqi
```

## æµè§ˆå™¨ç«¯ä½¿ç”¨

 æ·»åŠ  index.html æ–‡ä»¶

src/commonJS/index.html

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CommonJS</title>
    <script src='./index.js'></script>
  </head>
  <body>
    CommonJS æµè§ˆå™¨ç«¯ä½¿ç”¨
  </body>
</html>
```

æˆ‘ä»¬æµè§ˆå™¨æ‰“å¼€ HTML æ–‡ä»¶ï¼Œ å‘ç°æŠ¥é”™ï¼š` Uncaught ReferenceError: require is not defined`ã€‚ 



ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ç¼ºå°‘Node.Jsç¯å¢ƒçš„å˜é‡ï¼š`module`,`exports`,`require`,`global`ã€‚æ‰€ä»¥æµè§ˆå™¨æ˜¯æ— æ³•åŠ è½½CommonJsæ¨¡å—(npmæ¨¡å—)ï¼›

æ‰€ä»¥ï¼š `npm` æ¨¡å—çš„éƒ½æ˜¯ `JavaScript` è¯­è¨€å†™çš„ï¼Œä½†æ˜¯æµè§ˆå™¨ç”¨ä¸äº†ï¼Œ å½“ç„¶æ˜¯å› ä¸ºä¸æ”¯æŒ `CommonJS`æ ¼å¼ï¼›æ‰€ä»¥æƒ³è¦æµè§ˆå™¨èƒ½ä½¿ç”¨ä¸Šè¿™äº›æ¨¡å—ï¼Œ å°±è¦å¾—å¿…é¡»è½¬æ¢æ ¼å¼ã€‚



ç›®å‰æœ€å¸¸ç”¨çš„ `CommonJS`æ ¼å¼è½¬æ¢çš„å·¥å…·æ˜¯ï¼š[Browserify](http://browserify.org/)ï¼› é‚£æˆ‘ä»¬æ¥ä¸‹æ¥çš„ä¾‹å­(åŸºäºä¸Šé¢çš„ä¾‹å­)å°±ä½¿ç”¨[Browserify](http://browserify.org/) æ¥è½¬æ¢çš„ `CommonJS`ã€‚

Browserifyçš„ä½œç”¨ï¼š å°†åœ¨HTML å¼•ç”¨çš„jsæ–‡ä»¶æ‰“åŒ…ç¼–è¯‘ï¼Œæ˜¯çš„å…¶èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸Šè¿è¡Œ

### å®‰è£… Browserify

```javascript
// å…¨å±€å®‰è£…ï¼ˆæœ¬ä¾‹å­é‡‡ç”¨ï¼‰
npm install browserify -g

// å±€éƒ¨å®‰è£…
npm install browserify --save-dev
```

### æ‰“åŒ…ç¼–è¾‘

åœ¨è·Ÿç›®å½•æ‰§è¡Œï¼š

```javascript
browserify src/commonJS/index.js  -o src/commonJS/bundle.js
```

### å¼•ç”¨ç¼–è¯‘æ–‡ä»¶

src/commonJS/index2.html

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CommonJS</title>
    <script src='./bundle.js'></script>
  </head>
  <body>
    CommonJS æµè§ˆå™¨ç«¯ä½¿ç”¨
  </body>
</html>
```

æ‰“å¼€ HTMLã€‚æ§åˆ¶å°èƒ½æˆåŠŸèƒ½æˆåŠŸæ‰“å°ï¼š

```javascript
æ¨¡å—1
æ¨¡å—1
shuliqi
```

ç°åœ¨æœ€ç»ˆçš„æ–‡ä»¶ç»“æ„ä¸ºï¼š

```
|--src
  |--commonJS
    |--module1.js
    |--module2.js
    |--index.js
    |--index.html
    |--index2.html
    |--bundle.js
    |--require.js
|--package.json
|--package-lock.json
```



# AMD

åœ¨ ä¸Šä¸€èŠ‚`CommonJS` ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º `CommonJS`çš„åŠ è½½æ˜¯åŒæ­¥çš„ï¼Œå¦‚ï¼š

```javascript
const module1 = require('./module1');
console.log('1111')
```

ä¸Šé¢çš„ç¬¬äºŒè¡Œä»£ç å¿…é¡»åœ¨ ` require('./module1')`ä¹‹åè¿è¡Œï¼Œå› æ­¤æ˜¯å¿…é¡»è¦ç­‰ `module1.js`åŠ è½½å®Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåŠ è½½çš„æ—¶é—´å¾ˆé•¿çš„ï¼Œ æ•´ä¸ªåº”ç”¨æ˜¯ä¼šå¡åœ¨é‚£é‡Œçš„ã€‚



ä½†æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ‰€æœ‰çš„æ¨¡å—éƒ½æ˜¯æ”¾åœ¨æœ¬åœ°ç£ç›˜ï¼Œå¯ä»¥åŒæ­¥åŠ è½½å®Œæˆï¼Œç­‰å¾…çš„æ—¶é—´å°±æ˜¯ç¡¬ç›˜çš„è¯»å–æ—¶é—´ã€‚ä½†æ˜¯å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œç­‰å¾…çš„æ—¶é—´å–å†³äºç½‘é€Ÿçš„å¿«æ…¢ï¼Œå¯èƒ½è¦ç­‰å¾…å¾ˆé•¿çš„æ—¶é—´ï¼Œæµè§ˆå™¨å¤„äº"å‡æ­»"çŠ¶æ€ã€‚



æ‰€ä»¥æµè§ˆå™¨ç«¯çš„æ¨¡å—ä¸èƒ½é‡‡ç”¨â€œåŒæ­¥åŠ è½½â€ï¼Œ åªèƒ½é‡‡ç”¨â€œå¼‚æ­¥åŠ è½½â€ã€‚è¿™å°±æ˜¯`AMD`è§„èŒƒäº§ç”Ÿçš„èƒŒæ™¯

## åŸºæœ¬æ¦‚å¿µ

`AMD`-å¼‚æ­¥æ¨¡å—åŠ è½½å®šä¹‰ï¼Œé‡‡ç”¨å¼‚æ­¥æ–¹å¼åŠ è½½æ¨¡å—ï¼Œ æ¨¡å—çš„åŠ è½½ä¸å½±å“åé¢è¯­å¥çš„è¿è¡Œï¼Œæ‰€æœ‰ä¾èµ–è¿™ä¸ªæ¨¡å—çš„è¯­å¥éƒ½å®šä¹‰åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç­‰åˆ°æ¨¡å—å®Œæˆä¹‹åï¼Œ è¿™ä¸ªå›è°ƒå‡½æ•°æ‰ä¼šè¿è¡Œã€‚

### å®šä¹‰æš´éœ²æ¨¡å—

```javascript
// å®šä¹‰ä¸€ä¸ªæ²¡æœ‰ä¾èµ–çš„æ¨¡å—
define(function() {
  // xxx: æ¨¡å—
	return xxx
})	
```

```javascript
// å®šä¹‰ä¸€ä¸ªæ²¡æœ‰ä¾èµ–çš„æ¨¡å—
define(['module1', 'module2'], function() {
  // xxx: æ¨¡å—
	return xxx
})	
```

### å¼•ç”¨æ¨¡å—

å¦‚ä½•å¼•ç”¨`AMD`æ¨¡å—å‘¢ï¼Ÿè¿™é‡Œå…ˆè®²è®² `RequireJS` å’Œ `AMD`è§„èŒƒçš„å…³ç³»!

æˆ‘ä»¬çŸ¥é“çš„å¤§åé¼é¼çš„ `ReuireJS`ï¼Œå®é™…`ä¸ŠAMD `å°±æ˜¯`ReuireJS` åœ¨æ¨å¹¿çš„è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–äº§å‡ºï¼›

RequireJS æ˜¯ä¸€ä¸ªå·¥å…·åº“ï¼Œä¸»è¦æ˜¯ç”¨äºå®¢æˆ·ç«¯çš„æ¨¡å—ç®¡ç†ï¼Œå®ƒå¯ä»¥è®©å®¢æˆ·ç«¯çš„ä»£ç åˆ†æˆä¸€ä¸ªä¸ªæ¨¡å—ï¼Œå®ç°å¼‚æ­¥åŠ è½½å’ŒåŠ¨æ€åŠ è½½ã€‚ä»è€Œæé«˜ä»£ç çš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚é‡è¦çš„æ˜¯å®ƒçš„æ¨¡å—ç®¡ç†éµå®ˆ `AMDè§„èŒƒ`ã€‚ å¦‚æœæˆ‘ä»¬æ˜¯å¯ä»¥ä½¿ç”¨RequireJSæ¥åŠ è½½ `AMDæ¨¡å—`

 å…ˆå¼•å…¥`require.js`

 ```javascript
<script src="js/require.js" defer async="true" ></script>
 ```

å¼•å…¥`require.js` ä¹‹ååŠ è½½æˆ‘ä»¬è‡ªå·±çš„ä»£ç ï¼š

```javascript
<script src="js/require.js" data-main="js/main"></script>
```

> data-mainå±æ€§çš„ä½œç”¨æ˜¯ï¼šæŒ‡å®šç½‘é¡µçš„ä¸»æ¨¡å—ã€‚

AMDæ¨¡å—çš„åŠ è½½(ä¸»æ¨¡å—)

```javascript
require(['module1', 'module2'], function(module1, module2){
	// åœ¨å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨module1/module2
})
```

æ›´è¯¦ç»†çš„å¼•ç”¨æ–¹å¼ï¼Œ æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­

## ä¾‹å­ğŸŒ°

åœ¨åŸºäºä¸Šä¸€èŠ‚`CommonJS`çš„ç»“æ„ç›®å½•ï¼Œ æˆ‘ä»¬æ·»åŠ æ–°çš„ç›®å½•å’Œæ–‡ä»¶ 

```
|--src
  |--commonJS
    |--module1.js
    |--module2.js
    |--index.js
    |--index.html
    |--index2.html
    |--bundle.js
    |--require.js
  |--AMD
    |--index.html
    |--main.js
    |--module1.js
    |--module2.js
|--package.json
|--package-lock.json
```

### å®šä¹‰ï¼ˆæš´éœ²ï¼‰æ¨¡å—

src/AMD/module1.js

```javascript
// å®šä¹‰ä¸€ä¸ªæ²¡æœ‰ä¾èµ–çš„æ¨¡å—
define(function() {
  let name = "shuliqi";
  function getName() {
    return name;
  }
  // æš´éœ²æ¨¡å—
  return {  getName, name };
});
```

src/AMD/module2.js

```javascript
// åŠ è½½æœ‰ä¾èµ–çš„æ¨¡å—
// ä¾èµ–module1.js
define(['./module1.js'], function(module1) {
  let age = 12;
  function getMsg() {
    console.log('name:',module1.getName(), 'age:',  age);
  }
  // æš´éœ²æ¨¡å—
  return { getMsg };
});
```

### å¼•ç”¨æ¨¡å—

å¯ä»¥ä¸‹è½½ [require.js](http://browserify.org/),åˆ°æœ¬åœ°ç›´æ¥å¼•ç”¨ï¼Œ ä¹Ÿå¯ä»¥ç½‘ä¸Šçš„ [require.jsé“¾æ¥]https://requirejs.org/docs/release/2.3.6/minified/require.js)

```html
  <script  src="https://requirejs.org/docs/release/2.3.6/minified/require.js"  data-main="./main.js"></script>
```



src/AMD/index.html

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AMD</title>
    <script  src="https://requirejs.org/docs/release/2.3.6/minified/require.js"  data-main="./main.js"></script>
  </head>
  <body>
    AMD æµè§ˆå™¨ç«¯ä½¿ç”¨
  </body>
</html>
```



ä¸»æ¨¡å—main.js å¼•å…¥æˆ‘ä»¬çš„`module1` å’Œ` module2`

src/AMD/main.js

```javascript
require(['./module1', './mosule2'], function(module1, mosule2) {
  console.log(module1.name);
  mosule2.getMsg();
})
```

### ç»“æœ

æ‰“æ¥æˆ‘ä»¬çš„index,htmlæ–‡ä»¶ï¼Œç»“æœå¦‚ä¸‹ï¼š

{% asset_img 1.png %}

 ç»“æœè¯´æ˜ï¼šæµè§ˆå™¨èƒ½ä½¿ç”¨æˆ‘ä»¬çš„AMDæ¨¡å—äº†



# CMD

`ReuireJS`åœ¨å£°æ˜ä¾èµ–çš„æ¨¡å—æ—¶ä¼šåœ¨ç¬¬ä¸€æ—¶é—´åŠ è½½å¹¶ä¸”æ‰§è¡Œæ¨¡å—å†…éƒ¨çš„ä»£ç ï¼š

```javascript
require(['./module1', './mosule2'], function(module1, mosule2) {
 	// ç­‰äºåœ¨æœ€å‰é¢å£°æ˜å¹¶åˆå§‹åŒ–äº†è¦ç”¨åˆ°çš„æ‰€æœ‰æ¨¡å—
  
  // å¦‚ï¼šå³ä½¿æ²¡æœ‰ç”¨åˆ°æ¨¡å— module1ï¼Œä½†æ˜¯ module1 è¿˜æ˜¯æå‰æ‰§è¡Œäº†
  mosule2.getMsg();
})
```

è€Œ`CMD`åˆ™æ˜¯å¦å¤–ä¸€ç§` js` ä¼˜åŒ–æ–¹æ¡ˆï¼Œ å®ƒä¸` AMD` å¾ˆç±»ä¼¼ï¼Œè§„èŒƒä¹Ÿæ˜¯ä¸“é—¨ç”¨äºæµè§ˆå™¨ï¼Œæ¨¡å—çš„åŠ è½½ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œ ä½†æ˜¯æ¨¡å—ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šåŠ è½½æ‰§è¡Œã€‚`AMD` æ˜¯æ¨å´‡ä¾èµ–å‰ç½®ï¼Œæå‰æ‰§è¡Œï¼Œ`CMD` æ¨å´‡ä¾èµ–å°±è¿‘å»¶è¿Ÿæ‰§è¡Œã€‚

`CMD`æ˜¯ `Sea.js`æ¨å¹¿è¿‡ç¨‹ä¸­çš„äº§ç”Ÿçš„ï¼›

## åŸºæœ¬æ¦‚å¿µ

### å®šä¹‰æš´éœ²æ¨¡å—

åœ¨`CMD`ä¸­è§„èŒƒä¸­ï¼Œ ä¸€ä¸ªæ¨¡å—å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œ å®šä¹‰æš´éœ²æ¨¡å—çš„æ ¼å¼å¦‚ä¸‹ï¼š

```javascript
define(factory)
```

å½“`factory`ä¸ºå‡½æ•°æ—¶ï¼Œè¡¨ç¤ºæ˜¯æ¨¡å—çš„æ„é€ æ–¹æ³•ï¼Œæ‰§è¡Œè¿™ä¸ªæ„é€ æ–¹æ³•å°±å¯ä»¥å¾—åˆ°æ¨¡å—å‘å¤–æä¾›çš„æ¥å£ã€‚

`factory`æ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œé»˜è®¤ä¼šä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š`require`ï¼Œ`exports`å’Œ`module`ã€‚

* require æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è·å–å…¶ä»–æ¨¡å—æä¾›çš„æ¥å£

  `require.async` æ–¹æ³•ç”¨æ¥åœ¨æ¨¡å—å†…éƒ¨å¼‚æ­¥åŠ è½½æ¨¡å—ï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåæ‰§è¡ŒæŒ‡å®šå›è°ƒã€‚`callback` å‚æ•°å¯é€‰

  > **æ³¨æ„**ï¼š`require` æ˜¯åŒæ­¥å¾€ä¸‹æ‰§è¡Œï¼Œ`require.async` åˆ™æ˜¯å¼‚æ­¥å›è°ƒæ‰§è¡Œã€‚`require.async` ä¸€èˆ¬ç”¨æ¥åŠ è½½å¯å»¶è¿Ÿå¼‚æ­¥åŠ è½½çš„æ¨¡å—ã€‚

* exports æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ ç”¨æ¥å‘å¤–éƒ¨æä¾›æ¨¡å—æ¥å£

* module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•

```javascript
// å®šä¹‰æ²¡æœ‰ä¾èµ–çš„æ¨¡å—
define(function(require, exports, module) {
  // æš´éœ²æ¨¡å—
  exports.xxx = value
  module.exports = value
})
```

```javascript
// å®šä¹‰æœ‰ä¾èµ–çš„æ¨¡å—
define(function(require, exports, module) {
  // å¼•å…¥ä¾èµ–æ¨¡å—ï¼ˆåŒæ­¥ï¼‰
	const module1 = require('./module1')
  
  // å¼•å…¥ä¾èµ–æ¨¡å—ï¼ˆå¼‚æ­¥ï¼‰
  require.async('./module2', function(module2) {
    
  })
  
  // æš´éœ²æ¨¡å—
  exports.xxx = value
})
```



### å¼•ç”¨ä½¿ç”¨æ¨¡å—

ä½¿ç”¨ `require` æ¥å¼•ç”¨æ¨¡å—ã€‚ä¸Šé¢ä»£ç ä¹Ÿå†™è¿‡ã€‚

```javascript
define(function (require) {
  // å¼•å…¥ CMDæ¨¡å— module1
  var module1 = require('./module1')
  // å¼•å…¥ CMDæ¨¡å— module2
  var module2 = require('./module2')
})
```

## ä¸¾ä¾‹å­ğŸŒ°

`CMD`æ˜¯ `Sea.js`æ¨å¹¿è¿‡ç¨‹ä¸­çš„äº§ç”Ÿçš„ï¼›æ‰€æœ‰ç»“åˆ `Sea.js`æ¥ä½¿ç”¨ã€‚

åœ¨åŸå…ˆçš„é¡¹ç›®ç»“æ„ç›®å½•ä¸Šæˆ‘ä»¬åŠ è½½`CMD`ç›®å½•, æ·»åŠ æ–‡ä»¶

```
|--CMD
  |--index.html
  |--module1.js
  |--module2.js
  |--module3.js
  |--main.js

```

####  å¼•å…¥`Sea.js`

- å®˜ç½‘: [seajs.org/](http://seajs.org/)
- github : [github.com/seajs/seajs](https://github.com/seajs/seajs)

[åœ¨è¿™é‡Œä¸‹è½½](https://seajs.github.io/seajs/docs/#downloads) ç„¶åå°†`dist`ç›®å½•ä¸‹é¢çš„`sea.js`å¯¼å…¥é¡¹ç›®



```
|--CMD
  |--index.html
  |--module1.js
  |--module2.js
  |--module3.js
  |--main.js
  |--sea.js
```

#### å®šä¹‰æš´éœ²æ¨¡å—

module1.js

```javascript
// å®šä¹‰æ²¡æœ‰ä¾èµ–çš„æ¨¡å—
define(function(require, exports, module) {
  // æ¨¡å—å†…éƒ¨å˜é‡
  const name = "shuliqi";
  // æ¨¡å—å†…éƒ¨å‡½æ•°
  function getName() {
    return name;
  }

  // å‘å¤–æš´éœ²
  exports.getName = getName;
})
```

module2.js

```javascript
// å®šä¹‰æœ‰ä¾èµ–çš„æ¨¡å—
define( function(require, exports, module ) {
  // æ¨¡å—å†…éƒ¨å˜é‡
  const age = 18;
  // å¼•å…¥æ¨¡å—ï¼ˆåŒæ­¥ï¼‰
  const module1 = require('./module1');
  function getMsg() {
    console.log('name:', module1.getName(), 'age: ', age)
  }
  // å‘å¤–æš´éœ²æ¨¡å—
  module.exports = {  getMsg };

})
```

module3.js

```javascript
// å®šä¹‰æ²¡æœ‰ä¾èµ–çš„æ¨¡å—
define( function (require, exports, module) {
  exports.sex = "å¥³"
})
```

main.js

```javascript
// å®šä¹‰æœ‰ä¾èµ–çš„æ¨¡å—
define( function (require, exports, module) {
  // å¼•å…¥æ¨¡å—ï¼ˆåŒæ­¥ï¼‰
  const module2 = require('./module2');
  module2.getMsg();

  // å¼•å…¥æ¨¡å—ï¼ˆå¼‚æ­¥ï¼‰
  require.async('./module3', function(module3) {
    console.log('æˆ‘æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼š', module3.sex)
  })
})
```

#### æµè§ˆå™¨ä½¿ç”¨æ¨¡å—

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CMD</title>
    <script  src="./sea.js"></script>
  </head>
  <body>
    CMDæ¨¡å—åŒ– æµè§ˆå™¨ç«¯ä½¿ç”¨
    <script type="text/javascript">
        seajs.use('./main.js')
    </script>
  </body>
</html>
```

#### ç»“æœ

æ§åˆ¶å°èƒ½æˆåŠŸæ‰“å°ï¼š

```javascript
name: shuliqi age:  18
æˆ‘æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼š å¥³
```

# ES6 æ¨¡å—

åœ¨ `ES6`ä¹‹å‰ï¼Œæœ€åªè¦æ˜¯çš„æ¨¡å—è§„èŒƒæ˜¯ `CommonJS` å’Œ`AMD`,`CommonJS`ä¸»è¦ç”¨äºæœåŠ¡ç«¯ï¼Œ`AMD`ç”¨äºæµè§ˆå™¨ç«¯ï¼›`ES6`å®ç°äº†æ¨¡å—åŠŸèƒ½ï¼Œå®Œå…¨å¯ä»¥å–ä»£ `CommonJS` å’Œ`AMD`è§„èŒƒã€‚

 `ES6` æ¨¡å—çš„è®¾è®¡æ€æƒ³æ˜¯å°½é‡é™æ€åŒ–ï¼Œä½¿å¾—ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„å˜é‡ã€‚è€Œ`CommonJS` å’Œ`AMD`éƒ½æ˜¯åªèƒ½åœ¨è¿è¡Œçš„æ—¶å€™æ‰èƒ½ç¡®å®šè¿™äº›:

```javascript
// CommonJS
let { start, exists, readFile } = require('fs');

// ç­‰åŒäº
let _fs = require('fs');
let stat = _fs.stat;
let exists = _fs.exists;
let readfile = _fs.readfile;
```

è¿™ä»£ç å®è´¨æ˜¯åŠ è½½`fs`æ¨¡å—ï¼ˆå³åŠ è½½`fs`çš„æ‰€æœ‰æ¨¡å—ï¼‰ç”Ÿæˆä¸€ä¸ªå¯¹è±¡`_fs`, ç„¶åå†ä»è¿™ä¸ªå¯¹è±¡ä¸Šè¯»å– 3 ä¸ªæ–¹æ³•ã€‚ è¿™ç§åŠ è½½å°±ç§°ä¸ºâ€è¿è¡Œæ—¶åŠ è½½â€œï¼Œ å› ä¸ºåªæœ‰è¿è¡Œäº†æ‰èƒ½å¾—åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œå¯¼è‡´å®Œå…¨æ²¡åŠæ³•åœ¨ç¼–è¯‘æ—¶åšâ€é™æ€åŒ–â€œ



è€Œ`ES6`æ¨¡å—ä¸æ˜¯å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡`export`å‘½ä»¤æ˜¾ç¤ºçš„æŒ‡å®šè¾“å‡ºçš„ä»£ç ï¼Œå†é€šè¿‡`import`å‘½ä»¤è¾“å…¥ï¼š

```javascript
import { stat, exists, readFile } from 'fs';
```

è¿™ä»£ç çš„å®è´¨æ˜¯ä»`fs`æ¨¡å—åŠ è½½3 ä¸ªæ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•ä¸åŠ è½½ï¼Œè¿™ç§åŠ è½½ç§°ä¸ºâ€ç¼–è¯‘æ—¶åŠ è½½â€œæˆ–è€…â€é™æ€åŠ è½½â€œï¼Œå³ ES6å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±å®Œæˆæ¨¡å—åŠ è½½ï¼Œ æ•ˆç‡è¦æ¯” `CommonJS`æ¨¡å—çš„åŠ è½½æ–¹å¼é«˜ã€‚

## åŸºæœ¬æ¦‚å¿µ



### å®šä¹‰æš´éœ²æ¨¡å—

ä½¿ç”¨ `export`å‘½ä»¤ï¼Œ `export default `å‘½ä»¤æ¥æš´éœ²å¯¹å¤–çš„æ¥å£ã€‚å…¶ä¸­`export default `å‘½ä»¤æ˜¯ä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡º

> ä½¿ç”¨ `export`æš´éœ²å¯¹å¤–çš„æ¥å£ï¼Œ `import`å¼•ç”¨çš„æ—¶å€™éœ€è¦çŸ¥é“æ‰€è¦åŠ è½½çš„å˜é‡å/å‡½æ•°åï¼Œå¦åˆ™æ— æ³•åŠ è½½ï¼Œä¸ºäº†ç»™ç”¨æˆ·æä¾›æ–¹ä¾¿ï¼Œè®©ä»–ä»¬ä¸éœ€è¦é˜…è¯»æ–‡æ¡£å°±èƒ½åŠ è½½æ¨¡å—ï¼Œå°±å¯ä»¥ä½¿ç”¨`export default `å‘½ä»¤æ¥ä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡ºã€‚

```javascript
// æš´éœ²å˜é‡ ï¼ˆexport å‘½ä»¤ï¼‰
const name = 'shuliqi';
const age = 18;
export { name, age }

```

```javascript
// ä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡º
export default function () {
  console.log('shuliqi')
}
```

```javascript
// æš´éœ²å‡½æ•°æˆ–è€…ç±»
function getName() {
  return "shuliqi";
}
```

### å¼•ç”¨æ¨¡å—

ä½¿ç”¨ `import`å‘½ä»¤æ¥åŠ è½½æ¨¡å—ã€‚ä½†æ˜¯æš´éœ²æ¨¡å—çš„æ–¹å¼ï¼Œ`import` çš„ä½¿ç”¨ä¼šæœ‰æ‰€ä¸åŒ

- å¦‚æœæ˜¯ä½¿ç”¨`export`å‘½ä»¤å®šä¹‰äº†æ¨¡å—çš„å¯¹å¤–æ¥å£

  ```javascript
  // export.js
  // æš´éœ²å˜é‡ ï¼ˆexport å‘½ä»¤ï¼‰
  const name = 'shuliqi';
  const age = 18;
  export { name, age }
  ```

  ```javascript
  // å¼•ç”¨
  const { name, age } from './export.js';
  ```

- å¦‚æœä½¿ç”¨ `export default`æ¥åŠ è½½æ¨¡å—

  ```javascript
  // export-default.js
  // ä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡º
  export default function () {
    console.log('shuliqi')
  }
  ```

  ```javascript
  import customName from './export-default.js';
  customName()
  ```



## ä¾‹å­ğŸŒ°

åœ¨åŸæ¥çš„é¡¹ç›®ç»“æ„ä¸Šï¼ŒåŠ è½½`ES6`æ–‡ä»¶å¤¹åŠå…¶ä¸€äº›æ–‡ä»¶

```
|--ES6
  |--module1.js
  |--module2.js
  |--main.js
  |--index.js
  |--lib
  |--bundle.js
  
```

### å®šä¹‰æš´éœ²æ¨¡å—

module1.js

```javascript
// ä½¿ç”¨ export æš´éœ²æ¨¡å—
const name = "shuliqi";
function getName() {
  console.log(18);
}
export { name, getName };
```

module2.js

```javascript
// ä½¿ç”¨ export default ä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡º
const sex = 'å¥³';

export default function() {
  console.log(sex)
}
```

### å¼•ç”¨æ¨¡å—

main.js 

```javascript
import { name, getName } from './module1.js';
import getSex from './module2.js';
console.log(name);
getName();
getSex();
```



### å®‰è£…è½¬æ¢å™¨å’Œç¼–è¯‘å™¨

ç”±äºç›®å‰å„å¤§æµè§ˆå™¨å¯¹`ES6`çš„æ”¯æŒå¤§ä¸ç›¸åŒ, æ‰€ä»¥é€šå¸¸éœ€è¦æŠŠ`ES6`ä»£ç è½¬æ¢æˆ`ES5`çš„ä»£ç ï¼Œè¿™å°±éœ€è¦è½¬æ¢å™¨ï¼Œå¦‚ç°åœ¨å¹¿æ³›ä½¿ç”¨çš„ [Babel](https://babeljs.io/) ã€‚è½¬æ¢å®Œä¹‹åä»£ç éœ€è¦å†ç¼–è¯‘ä¸€ä¸‹ï¼Œ å°±å¯ä»¥åœ¨æµè§ˆå™¨ä½¿ç”¨äº†ã€‚

```javascript
// å®‰è£…babel-cli, babel-preset-es2015å’Œbrowserify
npm install babel-cli browserify -g
npm install babel-preset-es2015 --save-dev
```



åœ¨è·Ÿç›®å½•æ·»åŠ  `.babelrc`æ–‡ä»¶

```json
{
  "presets":[
      "es2015"
  ],
  "plugins":[]
}
```



è½¬ç æˆ‘ä»¬å†™çš„`ES6`ä»£ç å’Œç¼–è¯‘æˆ‘ä»¬çš„è½¬ç ä¹‹åçš„ä»£ç 

```javascript
// è½¬ç 
babel src/ES6 -d src/ES6/lib   
// ç¼–è¯‘
browserify src/ES6/lib/main.js -o src/ES6/bundle.js
```

å®Œæˆä¹‹åæˆ‘ä»¬çš„ES6æ–‡ä»¶ç›®å½•ä¸ºï¼š

```
|--ES6
  |--module1.js
  |--module2.js
  |--main.js
  |--index.js
  |--lib
       |--module1.js
       |--module2.js
       |--main.js
  |--bundle.js
```



### html æ–‡ä»¶ä½¿ç”¨

æœ€ååœ¨æˆ‘ä»¬çš„htmlæ–‡ä»¶ä¸­åŠ è½½æˆ‘ä»¬è½¬ç å’Œç¼–è¯‘ä¹‹åçš„ä»£ç  `bundle.js`

index.html

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ES6</title>
    <script src="./bundle.js"></script>
  </head>
  <body>
    ES6 æµè§ˆå™¨ç«¯ä½¿ç”¨
  </body>
</html>
```

æ‰“å¼€æµè§ˆå™¨ï¼Œç»“æœï¼š æ§åˆ¶å°èƒ½æ­£ç¡®æ‰“å°å‡ºï¼š

```
shuliqi
18
å¥³
```



**æœ€å**

æœ€åæ–‡ç« æ‰€æœ‰çš„ç¤ºä¾‹å¯ä»¥åœ¨[module-example](https://github.com/shuliqi/module-example)ä¸‹è½½

----



å‚è€ƒæ–‡ç« ï¼š

- [æµè§ˆå™¨åŠ è½½ CommonJS æ¨¡å—çš„åŸç†ä¸å®ç°](https://www.ruanyifeng.com/blog/2015/05/commonjs-in-browser.html)
- [CommonJSè§„èŒƒ](https://javascript.ruanyifeng.com/nodejs/module.html)
- [å‰ç«¯æ¨¡å—åŒ–è¯¦è§£(å®Œæ•´ç‰ˆ)](https://juejin.cn/post/6844903744518389768#heading-20)
- [browserify](http://browserify.org/)





- [RequireJSå’ŒAMDè§„èŒƒ](https://javascript.ruanyifeng.com/tool/requirejs.html)
- [å‰ç«¯æ¨¡å—åŒ–ï¼ˆAMDã€CommonJSã€UMDï¼‰æ€»ç»“](https://zhuanlan.zhihu.com/p/75980415)
- [Javascriptæ¨¡å—åŒ–ç¼–ç¨‹ï¼ˆäºŒï¼‰ï¼šAMDè§„èŒƒ](https://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html)
- [github-requirejs](https://github.com/requirejs/requirejs)
- [JS AMD æ¨¡å—è§„èŒƒ](https://ahuigo.github.io/b/ria/js-module-amd#/)
- [requirejs](https://requirejs.org/)



- [jxj-web](http://jxjweb.top/2017/08/0809.html)

- [seajs](https://github.com/seajs/seajs)

- [seajså®˜ç½‘](https://seajs.github.io/seajs/docs/#downloads)

-  [JSæ¨¡å—åŒ–åŠ è½½ä¹‹CommonJSã€AMDã€CMDã€ES6](https://zhuanlan.zhihu.com/p/41231046)

- [å‰ç«¯æ¨¡å—åŒ–ï¼šCommonJS,AMD,CMD,ES6](https://cloud.tencent.com/developer/article/1683007)
- [Browserifyï¼šæµè§ˆå™¨åŠ è½½Node.jsæ¨¡å—](https://javascript.ruanyifeng.com/tool/browserify.html)
- [browserify](http://browserify.org/)
- [ECMAScript 6 å…¥é—¨](https://es6.ruanyifeng.com/)








